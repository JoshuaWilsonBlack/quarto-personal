<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Joshua Wilson Black</title>
<link>https://joshua.wilsonblack.nz/posts.html</link>
<atom:link href="https://joshua.wilsonblack.nz/posts.xml" rel="self" type="application/rss+xml"/>
<description>Joshua Wilson Black&#39;s personal website.</description>
<generator>quarto-1.5.52</generator>
<lastBuildDate>Wed, 19 Jun 2024 12:00:00 GMT</lastBuildDate>
<item>
  <title>New Website with Quarto</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/new-website/</link>
  <description><![CDATA[ 




<p>I have just been through the effort of switching my academic website over from <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> — an interface between RMarkdown and Hugo Academic — to a <a href="https://quarto.org/docs/websites/">Quarto website</a>.</p>
<p>A few aspects of my process might be useful to others (and to future me), so I’ve written them down here.</p>
<p>All code for the website is available <a href="https://github.com/JoshuaWilsonBlack/quarto-personal">here</a>.</p>
<section id="initial-set-up-and-theme" class="level2">
<h2 class="anchored" data-anchor-id="initial-set-up-and-theme">Initial Set Up and Theme</h2>
<p>I began with the standard <a href="https://quarto.org/docs/websites/">‘Creating a Website’ instructions</a>, following the RStudio instructions.</p>
<p>As is clear from the documentation, there is a lot of moving back and forward between markdown files and the <code>_quarto.yml</code> file which sets overall options and structure for the website.</p>
<p>I picked the <code>litera</code> theme from the <a href="https://bootswatch.com/">provided options</a> and created <code>custom.scss</code> to change the fonts. This is determined by the following, at the end of my <code>_quarto.yml</code> file.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">html</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb1-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">[</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">litera</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">,</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> custom.scss</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">]</span></span>
<span id="cb1-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">css</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> styles.css</span></span>
<span id="cb1-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">toc</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span></code></pre></div>
<p>The <code>custom.scss</code> file looks like this:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/*-- scss:defaults --*/</span></span>
<span id="cb2-2"></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@import</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://fonts.googleapis.com/css2?family=Goudy+Bookletter+1911&amp;display=swap'</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">@import</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">url(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&amp;display=swap'</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">)</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-5"></span>
<span id="cb2-6">$font-family-serif<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> "EB Garamond"<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Georgia<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Cambria<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> "Times New Roman"<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> Times<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> serif !default;</span>
<span id="cb2-7">$font-family-heading<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> "Goudy Bookletter 1911";</span>
<span id="cb2-8">$font-family-base<span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> $font-family-serif;</span>
<span id="cb2-9"></span>
<span id="cb2-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/*-- scss:rules --*/</span></span>
<span id="cb2-11"></span>
<span id="cb2-12">h1<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> h2<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> h3<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> h4<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> h5<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> h6<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.menu-text</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.navbar-title</span> {</span>
<span id="cb2-13">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> $<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">font-family-heading</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-14">}</span>
<span id="cb2-15"></span>
<span id="cb2-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.menu-text</span> {</span>
<span id="cb2-17">  <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">font-family</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">:</span> $<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">font-family-heading</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb2-18">}</span></code></pre></div>
<p>I load the fonts from <a href="https://fonts.google.com/">Google Fonts</a>. To get a sense of what I wanted, I spent some time on the <a href="https://fontsinuse.com/">Fonts in Use</a> page. I was feeling fancy, so I went with serifs for both the main text and heading text.</p>
<p>In the <code>scss:defaults</code> section I paste in the embed code from Google Fonts for EB Garamond (my base font) and Goudy Bookletter 1911 (my heading font). These are then assigned to variables. The <code>$font-family-serif</code> variable has a series of backups which I copied from another theme (I can’t recall which). The line <code>$font-family-base: $font-family-serif</code> is the one which switches all the body text to EB Garamond. The <code>scss:rules</code> section contains the code which changes the menu text and all headings to Goudy Bookletter 1911.</p>
<p>A few other aesthetic points are worth mentioning. I added a <code>favicon</code> (this is the little image which appears in the corner of tabs on your browser). This image should be a small square (usually something like 32x32 pixels is fine, mine is a bit bigger). The image is how New Zealand appears in the <a href="https://en.wikipedia.org/wiki/Peirce_quincuncial_projection">Peirce quincuncial projection</a>. This is in the <code>images</code> direction with the name <code>favicon.png</code>. This is then referenced in the <code>_quarto.yml</code> file: <code>favicon: /images/favicon.png</code>. Note that paths should start with a forward slash. Quarto will deal with the rest.</p>
<p>I then put a small image in the footer.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">website</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # I've skipped a few lines here.</span></span>
<span id="cb3-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">page-footer</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">      center</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb3-5">        [![](/images/logo.png)](https://paperspast.natlib.govt.nz/newspapers/AS19031024.2.47.11.6.1) </span></code></pre></div>
<p>The image is a little mascot which I discovered in my research in the <a href="https://paperspast.natlip.govt.nz">Papers Past</a> collection. Again, the image is saved in the <code>images</code> folder. But this time the image is also a link to the original source using standard markdown syntax.</p>
</section>
<section id="structure" class="level2">
<h2 class="anchored" data-anchor-id="structure">Structure</h2>
<p>The website structure looks like this in <code>_quarto.yml</code>:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">website</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  # ...</span></span>
<span id="cb4-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">navbar</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb4-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb4-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">href</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> posts.qmd</span></span>
<span id="cb4-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Posts</span></span>
<span id="cb4-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">href</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> publications.qmd</span></span>
<span id="cb4-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Publications</span></span>
<span id="cb4-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">href</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> presentations.qmd</span></span>
<span id="cb4-10"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> Presentations</span></span>
<span id="cb4-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">      </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">href</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> index.qmd</span></span>
<span id="cb4-12"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">        </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">text</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> About</span></span></code></pre></div>
<p>The order of these pages determines their order on the navigation bar of the website. The <code>href</code> entries give the name of the quarto document for the page and the <code>text</code> entry gives the text which will appear in the menu.</p>
<p>The bottom entry gives the <a href="https://quarto.org/docs/websites/website-about.html">‘about’ page</a>. The about page provides a short bio, employment, and educational history along with links to various other pages and profiles. I wanted the ‘about’ page to be the first page you arrive at when you go to my web address ( <code>joshua.wilsonblack.nz</code>). This is determined by the fact that it is called <code>index.qmd</code>. Whatever you have in <code>index.qmd</code> will be the home page of the website.</p>
<p>The first entry is a <a href="https://quarto.org/docs/websites/website-listings.html">listing page</a> for blog posts (<code>posts.qmd</code>). This has a very simple structure:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posts"</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">listing</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb5-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contents</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> posts</span></span>
<span id="cb5-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">categories</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span>
<span id="cb5-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date desc"</span></span>
<span id="cb5-6"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> default</span></span>
<span id="cb5-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">feed</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">true</span></span></code></pre></div>
<p>The line <code>contents: posts</code> means posts are read from a directory called <code>posts</code>. Each post has its own directory in the <code>posts</code> directory. For instance, this post is in the directory <code>posts/new-website/</code>. Within this directory, there is an <code>index.qmd</code> file with the post contents and any resources related to the post (images, datafiles, pdfs &amp;c.&nbsp;&amp;c.).</p>
<p>I didn’t have many posts on my old website, so I transferred them across manually. The only thing I had to do was rename the markdown files <code>index.qmd</code> and change the yaml options to match those available in <a href="https://quarto.org/docs/reference/formats/html.html">Quarto html documents</a>.</p>
<p>I have a <code>presentations</code> and <code>publications</code> page, which contain details of… my presentations and publications. Both generate a fairly straight forward bibliography, with my name highlighted when it appears (as is common in CVs).</p>
<p>Another line in <code>_quarto.yml</code> is significant for the structure of the website. I like to host html slides on my website. You can’t have quarto presentations <em>as part of</em> a quarto website (or, if you can it looks difficult). The resources option in</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span></span>
<span id="cb6-2"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">type</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> website</span></span>
<span id="cb6-3"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resources</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb6-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">    </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"slides"</span></span></code></pre></div>
<p>means that anything in the <code>slides</code> directory will be published. I can then generate slides elsewhere and copy across the <code>.html</code> file and any other resources into a directory in <code>slides</code>. For instance, my Australian Linguistic Society presentation from last year is accessible at <a href="https://joshua.wilsonblack.nz/slides/als-2023/" class="uri">https://joshua.wilsonblack.nz/slides/als-2023/</a>, Here I make sure the <code>.html</code> file is named <code>index.html</code>.</p>
</section>
<section id="wrangling" class="level2">
<h2 class="anchored" data-anchor-id="wrangling">Wrangling</h2>
<p>It is a pain to have to write down the same information in many different places. This is not just an annoyance though: every time you re-enter information is an opportunity to introduce errors. If, instead, you have a ‘single source of truth’, you only have to get it right once.</p>
<p>In an ideal world, you would enter details of your employment, education, and research outputs in a single place and the information would propagate out to your website, your CV, your institutional profiles, and wherever else you might need it.</p>
<p><a href="https://en.wikipedia.org/wiki/ORCID">ORCID</a> would be ideal for this. It has an API for reading information and can sync up with my University’s research maangement software (Symplectic Elements). In the current version of this website, I take my employment and education information from my <code>ORCID</code> profile. I’ve done this using the <a href="https://ciakovx.github.io/rorcid.html"><code>rorcid</code> package</a>. Have a look at the code in <code>index.qmd</code>. The basic idea is to download the information from my ORCID profile, wrangle it into a data frame, create a string in markdown format, and save this to an external file. I then load the file using the Quarto shortcode, e.g., <code>{{&lt; include experience.md &gt;}}</code>.</p>
<p>I would like to do something similar for my publications and presentations. Perhaps I could download the information, save it to a bibtex file, and then generate a bibliography. I haven’t implemented this yet, but intend to for future publications and presentations.</p>
<p>Currently, I maintain a collection for my publications and my presentations in <a href="https://www.zotero.org/">Zotero</a> (along with the <a href="https://retorque.re/zotero-better-bibtex/">Better BibTeX</a> plugin). These are exported as <code>.bib</code> files to the root directory of my website project.</p>
<p>The <code>presentations.qmd</code> file provides a good example of how this works:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">title</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Presentations"</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bibliography</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> presentations.bib</span></span>
<span id="cb7-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">csl</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> chicago-mod.csl</span></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nocite</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">|</span></span>
<span id="cb7-5">  @*</span>
<span id="cb7-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filters</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span></span>
<span id="cb7-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> dociteproc</span></span>
<span id="cb7-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> boldname</span></span>
<span id="cb7-9"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">  </span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">-</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> url2slides</span></span>
<span id="cb7-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">citeproc</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">:</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;"> </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">false</span></span></code></pre></div>
<p>The <code>bibliography: presentations.bib</code> file loads the bibliography. The line starting <code>nocite:</code> says that <em>everything</em> from the bibliography file should appear on the page. The rest is a little more tricky.</p>
<p>I took the default bibliography style, which conforms to the Chicago Manual of Style, and slightly modified it. I took the <code>.csl</code> file from <a href="https://www.zotero.org/styles/chicago-author-date-16th-edition">here</a>, and renamed it <code>chicago-mod.csl</code>. My only change is in the <code>&lt;sort&gt;</code> section, as follows:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb8-1">&lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span>&gt;</span>
<span id="cb8-2">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">key</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> macro=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> sort=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"descending"</span>/&gt;</span>
<span id="cb8-3">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">key</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> macro=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"day-month"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> sort=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"descending"</span>/&gt;</span>
<span id="cb8-4">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">key</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> variable=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"issued"</span>/&gt;</span>
<span id="cb8-5">  &lt;<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">key</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> variable=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title"</span>/&gt;</span>
<span id="cb8-6">&lt;/<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">sort</span>&gt;</span></code></pre></div>
<p>This means the items are sorted in reverse chronological order.</p>
<p>The final complication is the set of Lua filters, listed after <code>filters</code> and the option <code>citeproc: false</code>. The first two are explained <a href="https://www.neilwright.uk/posts/quarto-bibliography-format-name">here</a>.</p>
<p>The <code>url2slides</code> filter takes any url on the presentations page and converts it to a hyper link with the text ‘[Slides]’. This looks a little neater to me. The key part of the Lua script looks like this:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb9-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">el</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">].</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">t</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Link"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">then</span></span>
<span id="cb9-2">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">local</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">el</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">].</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">target</span></span>
<span id="cb9-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">el</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">content</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">k</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">pandoc</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>Link<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">(</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[Slides]"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">url</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">)</span></span></code></pre></div>
<p>I know basically nothing about Lua. There are nice documentation pages from Quarto about <a href="https://quarto.org/docs/extensions/lua.html">Lua</a> and <a href="https://quarto.org/docs/extensions/filters.html">filters</a>.</p>
</section>
<section id="publishing" class="level2">
<h2 class="anchored" data-anchor-id="publishing">Publishing</h2>
<p>I followed <a href="https://quarto.org/docs/publishing/netlify.html#publish-from-git-provider">the instructions</a> to publish using <a href="https://www.netlify.com/">Netlify</a> via GitHub. This means the website will update the GitHub repository has a new commit. The one downside is that you have to include the rendered website (everything in the <code>_site</code> directory in the git repository — this can be a bit messy).</p>
<p>One benefit of hosting the website with Netlify is that it has straight forward redirection rules, which can are specified in the <code>_redirects</code> file. This is useful to ensure that links to blog posts and slides from my previous website will go to the corresponding pages on the new website. These rules can be as simple as, e.g., <code>/post/* /posts/:splat</code>. This means any address with <code>/post</code> will be directed to one with <code>/posts</code>. The posts folder on my old Hugo website was called <code>post</code>, but otherwise the urls are the same.</p>
<p>Finally, I point the domain I registered using <a href="https://metaname.net" class="uri">https://metaname.net</a> (<code>joshua.wilsonblack.nz</code>) to the Netlify page.</p>


</section>

 ]]></description>
  <category>quarto</category>
  <guid>https://joshua.wilsonblack.nz/posts/new-website/</guid>
  <pubDate>Wed, 19 Jun 2024 12:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/new-website/feature.gif" medium="image" type="image/gif"/>
</item>
<item>
  <title>New Publication: Creating Specialised Corpora from Digitized Historical Newspaper Archives</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/digital-scholarship-in-the-humanities/</link>
  <description><![CDATA[ 




<p>One of the promises of digital humanities for the ‘historical sciences’ is that we’ll be able to, in <a href="https://www.tandfonline.com/doi/abs/10.2752/147800413X13515292098070">Tim Hitchcock’s</a> words, shift from ‘piles of books’ to ‘maps of meaning’. That is, we’ll be able to produce high level representations of phenomena across large collections of text. These could come in all sorts of forms. But, for a concrete example, consider the following:</p>
<p><img src="https://joshua.wilsonblack.nz/posts/digital-scholarship-in-the-humanities/map.jpeg" class="img-fluid"></p>
<p>This is a ‘cooccurence network’ for the term ‘materialism’ as it appears in a corpus of pre-1900 newspaper items from New Zealand. It depicts terms which a connected to ‘materialism’ in a statistically surprising way and terms which are similarly surprisingly connected to those terms. Networks of this sort can both motivate specific research questions and provide a depiction of the wider context for the use of a given term. More such networks can be produced <a href="https://nznewspaperphilosophy.canterbury.ac.nz">here</a>. The same link provides an explanation of the meaning of these connections.</p>
<p>When confronted with a huge collections of digitised material, it is very hard for an individual researcher or small team of researchers with interests in a specialised topic and limited computational researchers to apply contemporary text mining and other computational methods. With 1000s of GPUs and 1000s of hours to run them (not to mention the gas to burn), you can create a highly general representation of what is going on in a collection of texts and then query it about specific topics. This is one way of thinking about what ChatGPT etc are: interactive general representations of phenomena in this or that large-scale collection of texts (rather than ‘intelligence’ in any sense I’d consider meaningful). We thus need methods for selecting items for inclusion in corpora. Moreover, for reasons described in the paper, we want methods which do not rely on simple keyword searches.</p>
<p>My contribution to this problem has just been published with open access in <em>Digital Scholarship in the Humanities</em>. The paper is called <a href="https://academic.oup.com/dsh/advance-article/doi/10.1093/llc/fqac079/6957053">“Creating specialized corpora from digitized historical newspaper archives: An iterative bootstrapping approach”</a>. It provides a methodological motivation for applying text mining techniques to historical datasets and sets up the need for methods to select subsets of these datasets for analysis. It then provides a general approach to producing corpora for analysis from large historical newspaper collections along with Python code for each stage of the process.</p>
<p>The core idea of the method is that the text mining methods which we want to apply to gain insight into a specialised topic can also be used to generate increasingly focused corpora. We start with some initial candidate corpus, and apply methods such as cooccurrence network analysis or topic modelling, in order to find material which is either relevant or not relevant to our topic. We label the material and then train naive Bayes classifiers, which are then applied to the full newspaper dataset to generate a new candidate corpus. That is, we work upwards from an inappropriate corpus of items (inappropriate by including lots of irrelevant material and/or excluding relevant material). As we iterate this process, the corpus becomes increasingly targeted. I illustrate the method by generating a corpus of philosophical discourse in pre-1900 English-language New Zealand newspaper data made available by the <a href="https://natlib.govt.nz/about-us/open-data/papers-past-metadata">National Library of New Zealand</a>.</p>
<p>I’m a bit slow in making a noise about this publication. It came out as I was in the hospital for the birth of my first child, Clement. Clem and his mum are doing very well. I am now returning to work now after my parental leave.</p>
<p>I should also say that in the proofing phase I missed the fact that my sectioning was flattened to a single level! Perhaps this was (pre-)baby brain.</p>
<p>What are the next steps? This paper came out of a summer project towards my data science qualification. As such, it very much focuses on the general methodological problem outlined above. I am currently working on a paper in the history of philosophy which actually <em>uses</em> the corpus I report on in this paper. The basic idea is to focus attention use the newspaper controversy generated by <a href="https://en.wikipedia.org/wiki/William_Salmond_(Presbyterian_minister)">William Salmond’s</a> pamphlet <em>The Reign of Grace</em> (see <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/1467-9809.12089">Wood, 2014</a>). Salmond argues, against then overwhelmingly dominant forms of Christianity, that human beings can be saved <em>after</em> they die. A combination of traditional close reading and the use of cooccurrence networks will be used to reveal deep connections between the theological questions of heaven and hell and the live political questions about nature and purpose of punishment. But this is another story.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/digital-scholarship-in-the-humanities/feature.png" class="img-fluid figure-img"></p>
<figcaption>An ancestor of mine in the Papers Past dataset.</figcaption>
</figure>
</div>



 ]]></description>
  <category>history of philosophy</category>
  <category>digital humanities</category>
  <guid>https://joshua.wilsonblack.nz/posts/digital-scholarship-in-the-humanities/</guid>
  <pubDate>Wed, 25 Jan 2023 11:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/digital-scholarship-in-the-humanities/feature.png" medium="image" type="image/png" height="118" width="144"/>
</item>
<item>
  <title>Model Check and Significance Testing for Vowel Space GAMMs</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In a <a href="https://joshua.wilsonblack.nz/post/visualising-vowel-space-gamms/">previous post</a>, I set out a workflow for fitting and visualising generalised additive mixed models for F1 and F2 of a series of vowels and using these to visualise change over an entire vowel space.</p>
<p>In that post, I waved off the issue of evaluating individual models. In this post I’d like to fill out two aspects of this and link them to the workflow I presented in the previous post. The first is the use of the <code>gam.check</code> function to work out if your smooths enable sufficient ‘wiggliness’ for your data and whether the assumption of normally distributed residuals holds. The second is to show how information about model significance can be extracted both in terms of significance of change in a given vowels trajectory <em>over time</em> and in terms of the difference <em>between</em> the trajectories of, say, men and women (following the recent advice of <a href="https://www.sciencedirect.com/science/article/pii/S009544702030108X">Márton Sóskuthy</a>.</p>
<p>We’ll very quickly run through fitting models using the nest and mutate approach (using <code>purrr</code>), look at the use of <code>gam.check</code> within this framework, and then turn to significance testing. I’ll conclude by adding an indication of significance to the static and animated vowel space plots presented in the previous post.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/feature.jpg" class="img-fluid figure-img"></p>
<figcaption>NZBC Presents Logo (<a href="https://www.lonely.geek.nz/kiwi-tv/index.php/tv-shows-mainmenu-42/42-help-needed/2291-nzbc-presents-nh">source</a>)</figcaption>
</figure>
</div>
</section>
<section id="model-fit-again" class="level2">
<h2 class="anchored" data-anchor-id="model-fit-again">Model Fit (Again)</h2>
<p>I’ll rush over this part, given that it is covered in the previous post.</p>
<p>Three things are worth noting:</p>
<ol type="1">
<li><p>I’m bringing in the data for the models using my own package <code>nzilbb.vowels</code>. This is <em>very much</em> work in progress and I don’t promise anything about it’s future versions! I will endeavour to keep this post functional.</p></li>
<li><p>I’ll point out where the structure differs from that used in the previous post.</p></li>
<li><p>Unlike the previous post, I’m using raw token data from each speaker rather than just taking their mean values. This makes the data a little noisier and the models a little harder to fit.</p></li>
</ol>
<p>Let’s load some libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Required tidyverse packages </span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (I occasionally try to do without 'library(tidyverse)')</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyr)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(stringr)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(purrr)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(glue)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gganimate)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gtools library for generating pval stars.</span></span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gtools)</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mgcv for gamms, itsadug for gamm visualisation</span></span>
<span id="cb1-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mgcv)</span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(itsadug)</span>
<span id="cb1-17"></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># nzilbb.vowels for data and some helper functions</span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To install, use remotes::install_github('JoshuaWilsonBlack/nzilbb_vowels')</span></span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(nzilbb.vowels)</span></code></pre></div>
</div>
<p>Our data is built in to <code>nzilbb.vowels</code> under the name <code>onze_vowels</code>. Our modelling requires that we represent our factors as factor vectors rather than character vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">onze_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>(onze_vowels) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'speaker'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'vowel'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'word'</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.fn =</span> as.factor),</span>
<span id="cb2-4">  )</span></code></pre></div>
</div>
<p>The next steps will fly by without much comment. We apply Lobanov 2.0 filtering and remove the old F1 and F2 values for convenience.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">onze_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lobanov_2</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(F1_50<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>F2_50))</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(speaker, vowel)`</code></pre>
</div>
</div>
<p>Next, we pivot the data so that the normalised F1 and F2 data appears in a single column, group the tibble and nest so that we have a row for each model we want to fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">   <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb5-3">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> F1_lob2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>F2_lob2,</span>
<span id="cb5-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"formant_type"</span>,</span>
<span id="cb5-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"formant_value"</span></span>
<span id="cb5-6">   ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(vowel, formant_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span></code></pre></div>
</div>
<p>Now it’s time to fit some models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb6-4">      data,</span>
<span id="cb6-5">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bam</span>(</span>
<span id="cb6-6">        formant_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(yob, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> gender) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># main effects</span></span>
<span id="cb6-7">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(speech_rate) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># control variable</span></span>
<span id="cb6-8">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(speaker, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'re'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(word, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># random effects</span></span>
<span id="cb6-9">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .x,</span>
<span id="cb6-10">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">discrete =</span> T,</span>
<span id="cb6-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nthreads =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I'm on a silly computer right now. </span></span>
<span id="cb6-12">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perhaps reduce nthreads to 4.</span></span>
<span id="cb6-13">      )</span>
<span id="cb6-14">    )</span>
<span id="cb6-15">  )</span></code></pre></div>
</div>
</section>
<section id="using-gam.check" class="level2">
<h2 class="anchored" data-anchor-id="using-gam.check">Using <code>gam.check</code></h2>
<p>The function <code>gam.check</code> from <code>mgcv</code> tells us a lot about a GAMM. Here it is for the first GAMM in our tibble. This can be done by taking the first object from the model column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam.check</span>(onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]])</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Method: fREML   Optimizer: perf chol
$grad
[1] -2.459495e-05 -2.930034e-08 -4.469310e-05  1.003085e-05 -7.541875e-07
[6]  1.565537e-05

$hess
           [,1]          [,2]          [,3]          [,4]          [,5]
   2.459335e-05 -5.261901e-09 -2.823390e-11 -1.002578e-05  7.548775e-07
  -5.261901e-09  9.229684e-02 -4.556448e-07  1.542197e-01 -6.173866e-03
  -2.823390e-11 -4.556448e-07  4.469058e-05 -6.994732e-06 -1.076207e-06
  -1.002578e-05  1.542197e-01 -6.994732e-06  3.353799e+01 -2.782142e-02
   7.548775e-07 -6.173866e-03 -1.076207e-06 -2.782142e-02  1.462190e+01
d -1.561899e-05 -3.098834e-01 -8.006339e-06 -3.960741e+01 -3.784472e+01
           [,6]
  -1.561899e-05
  -3.098834e-01
  -8.006339e-06
  -3.960741e+01
  -3.784472e+01
d  3.468500e+03

Model rank =  621 / 621 

Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
indicate that k is too low, especially if edf is close to k'.

                   k'    edf k-index p-value  
s(yob):genderF   9.00   1.00    1.01   0.815  
s(yob):genderM   9.00   1.62    1.01   0.835  
s(speech_rate)   9.00   1.00    0.96   0.015 *
s(speaker)     100.00  79.21      NA      NA  
s(word)        492.00  75.69      NA      NA  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We get:</p>
<ul>
<li>A qq-plot and a histogram of residuals. Both suggest heavy tails. This seems to be quite common with formant data. One option to deal with this, although it increases computation load, is to use a scaled t distribution as our residual model. This can be done by adding <code>family = scat(link='identity'))</code> to the arguments of the <code>bam</code> function. I won’t explore this option in this post.</li>
<li>Two scatter plots of residuals. The linear predictor is the one to look at. There is no obvious pattern in this case. This is good!</li>
<li>Console output within which the main thing to check is the ‘Basis dimension (k) checking results’. These indicate the possible degrees of freedom (<code>k'</code>) which each smooth is provided by the model specification and the effective degrees of freedom (<code>edf</code>) of the smooth which has been fit to the data. We want to avoid the combination of low p-values and <code>edf</code> close to <code>k'</code>. The current output doesn’t have anything to worry about here either. If <code>edf</code> gets close to <code>k'</code> we can increase the possible ‘wiggliness’ of the relevant term by adding the argument, say, <code>k = 11</code> (which is one higher than the default value of 10) to the relevant smooth specification. When fitting the same model formula to multiple datasets, we need to pick a <code>k</code> value which works for all. Practically speaking, the only cost to increasing <code>k</code> is computational.</li>
</ul>
<p><code>gam.check</code> does not return a value. So we can’t save it’s results using the <code>mutate</code> and <code>map</code> approach used above. I suggest <code>walk</code>ing through the data in the following way. This will output the plots and console output for each of the models in turn. The output is not given here to avoid this post becoming <em>very</em> long.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">walk2</span>(</span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_c</span>(onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vowel, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'_'</span>, onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>formant_type),</span>
<span id="cb9-3">  onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model,</span>
<span id="cb9-4">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> {</span>
<span id="cb9-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(.x)</span>
<span id="cb9-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gam.check</span>(.y)</span>
<span id="cb9-7">  }</span>
<span id="cb9-8">)</span></code></pre></div>
</div>
<p>One downside of the approach to fitting multiple models I’m suggesting here is that the same structure has to be used for all of them. The use of <code>gam.check</code> here is odd insofar as we are testing a series of particular models, but can only modify the general structure which we have set to apply to each model. It may be that there is a ‘tidymodelling’ approach which enables tweaking of each model. I’d be keen to hear of any such thing.</p>
<p>As always in statistics, you can’t just rely on a one-size-fits-all recipe. Reflection on the nature of your own data should always be involved in your selection of ‘k’.</p>
</section>
<section id="significance-testing" class="level2">
<h2 class="anchored" data-anchor-id="significance-testing">Significance Testing</h2>
<p>We have produced models of normalised first and second formant values for New Zealand English monophthongs over a long span of time. We’ve fit distinct model for each vowel and formant type pair (a model for <span style="font-variant:
small-caps;">dress</span> F1, a model for <span style="font-variant:
small-caps;">dress</span> F2, &amp;c.&nbsp;&amp;c…). <em>Within</em> each of these models, we fit a distinct smooth for the two gender categories in the data.</p>
<section id="p-values-for-by-factor-smooths-from-the-model-summary" class="level3">
<h3 class="anchored" data-anchor-id="p-values-for-by-factor-smooths-from-the-model-summary">P-Values for By-Factor Smooths from the Model Summary</h3>
<p>The simplest method, if we are interested in which trajectories through the vowel space represent statistically significant changes is to extract p-values from the model summaries produced by the <code>summary</code> function.</p>
<p>In this case, we say that a trajectory is significant if <em>either</em> the p-value for the F1 smooth <em>or</em> the F2 smooth is less than 0.05. This kind of disjunctive use of p-values leads to false positives. So, for similar reasons to those presented in the Sóskuthy paper linked above, it is wise to apply the Bonferroni correction here. Since two p-value are involved, we simply divide our threshold for significance by 2, to give a new threshold of 0.0025.</p>
<p>Here’s what the output of <code>summary</code> applied to one of our models looks like (I’ve picked one with significant effects on year of birth).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">model_index <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb10-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel = "</span>, onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>vowel[[model_index]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Vowel = FLEECE"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Formant type = "</span>, onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>formant_type[[model_index]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Formant type = F1_lob2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
formant_value ~ gender + s(yob, by = gender) + s(speech_rate) + 
    s(speaker, bs = "re") + s(word, bs = "re")

Parametric coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.03870    0.02515 -41.306  &lt; 2e-16 ***
genderM     -0.15620    0.02947  -5.301 1.17e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                   edf  Ref.df      F p-value    
s(yob):genderF   1.533   1.597 65.436  &lt;2e-16 ***
s(yob):genderM   2.684   2.795 39.972  &lt;2e-16 ***
s(speech_rate)   1.000   1.000  1.924   0.165    
s(speaker)      74.509  96.000  7.205  &lt;2e-16 ***
s(word)        215.748 734.000  1.968  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.221   Deviance explained =   24%
fREML =  10133  Scale est. = 0.30672   n = 11896</code></pre>
</div>
</div>
<p>This is the model for <span class="smallcaps">fleece</span> F1. The parametric coefficients show the intercept terms for the women (<code>(Intercept)</code>) and the <code>genderM</code> term for the men. This gives the average (normalised) value for <span class="smallcaps">fleece</span> F1 for the women and the <em>difference</em> between this and the average for the men. The difference between these values comes out as significant. But what we’re really interested in is whether they differ across the year of birth variable.</p>
<p>To see this, we look at the smooth terms. As the heading suggests, these are ‘approximate’ significances. For our purposes, this just means there’s ‘mathematical dragons lurking about here. All we ought to know is that, if a p-value is ’quite close’ to our cut off, we should report that. The p-values we are looking at for this model do not have this problem. We’re looking at the values for <code>s(yob):genderF</code> and <code>s(yob):genderM</code>. In both cases, they are less than <img src="https://latex.codecogs.com/png.latex?2%5Ctimes10%5E%7B-16%7D">.</p>
<p>While we’re at it, let’s plot these smooths using the <code>plot_smooth</code> function from <code>itsadug</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_smooth</span>(</span>
<span id="cb16-2">  onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[model_index]], </span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">view=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span>, </span>
<span id="cb16-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot_all =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>,</span>
<span id="cb16-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FLEECE F1 Year of Birth Smooths"</span>,</span>
<span id="cb16-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rug =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb16-7">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary:
    * gender : factor; set to the value(s): F, M. 
    * yob : numeric predictor; with 30 values ranging from 1864.000000 to 1981.000000. 
    * speech_rate : numeric predictor; set to the value(s): 4.5576. 
    * speaker : factor; set to the value(s): IA_f_527. (Might be canceled as random effect, check below.) 
    * word : factor; set to the value(s): word_12921. (Might be canceled as random effect, check below.) 
    * NOTE : The following random effects columns are canceled: s(speaker),s(word)
 </code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/fleece-smooths-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Smooths for males and females from FLEECE F1 model.</figcaption>
</figure>
</div>
</div>
</div>
<p>There’s no way to tell from the <code>summary</code> output what the nature of the two smooths is. We will turn to the question of whether the two smooths are significantly different <em>from one another</em> in moment. But with the current model, we can see that both a significantly different <em>from 0</em>.</p>
<p>In order for us to access the p-values for <code>s(yob):genderM</code> and <code>s(yob):GenderF</code> for <em>all</em> of our models at once, we need to know a bit more about how the output of <code>summary</code> is stored by R: <code>summary</code>, when applied to a GAMM, produces a named list with information about the GAMM (run <code>?summary.gam</code> to see the details). We need the first two smooth p-values. These are stored with the name <code>s.pv</code>.</p>
<p>To extract this information for each model, we create a new column which extracts the p-values for the smooths from the summary of each GAMM, and then columns for each of the p-values we are interested in. This can be done as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb18-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model_smooth_pvs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb18-4">      model,</span>
<span id="cb18-5">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(.x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s.pv</span>
<span id="cb18-6">    ),</span>
<span id="cb18-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">genderF_smooth_pv =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(</span>
<span id="cb18-8">      model_smooth_pvs,</span>
<span id="cb18-9">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb18-10">    ),</span>
<span id="cb18-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">genderM_smooth_pv =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(</span>
<span id="cb18-12">      model_smooth_pvs,</span>
<span id="cb18-13">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb18-14">    )</span>
<span id="cb18-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>model_smooth_pvs)</span></code></pre></div>
</div>
<p>Notice the use of <code>map_dbl</code>, which ensures that the resulting column is numerical rather than a list column. If anyone reading this has any idea of how to generate approximate p-values for the smooth terms in these models without running <code>summary</code>, I’d greatly appreciate it! This block takes a very long time to run.</p>
<p>We can look at the trajectories which appear as significant for either the males or females using the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>model, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sometimes it's good to exclude the columns with </span></span>
<span id="cb19-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># large objects. </span></span>
<span id="cb19-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(genderF_smooth_pv <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> genderM_smooth_pv <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
# Groups:   vowel, formant_type [20]
   vowel   formant_type genderF_smooth_pv genderM_smooth_pv
   &lt;fct&gt;   &lt;chr&gt;                    &lt;dbl&gt;             &lt;dbl&gt;
 1 THOUGHT F1_lob2             0.237            0.00000107 
 2 THOUGHT F2_lob2             0.0646           0.00454    
 3 FLEECE  F1_lob2             0                0          
 4 FLEECE  F2_lob2             0.00143          0          
 5 KIT     F1_lob2             0                0          
 6 KIT     F2_lob2             0                0          
 7 DRESS   F1_lob2             0                0          
 8 DRESS   F2_lob2             0.0454           0.000601   
 9 GOOSE   F1_lob2             0                0.00000863 
10 GOOSE   F2_lob2             0.000124         0          
11 TRAP    F1_lob2             0                0          
12 TRAP    F2_lob2             0.000969         0.254      
13 START   F1_lob2             0.00438          0.000000694
14 START   F2_lob2             0.0269           0.0154     
15 STRUT   F1_lob2             0.0000647        0          
16 STRUT   F2_lob2             0                0.000000718
17 NURSE   F1_lob2             0                0          
18 NURSE   F2_lob2             0.00000633       0.00000139 
19 LOT     F1_lob2             0.00136          0.428      
20 LOT     F2_lob2             0.00000706       0          </code></pre>
</div>
</div>
<p>Each is ‘significant’ by the 0.05 threshold for one gender or the other.</p>
</section>
<section id="plotting-significance-of-by-factor-smooths-in-vowel-space" class="level3">
<h3 class="anchored" data-anchor-id="plotting-significance-of-by-factor-smooths-in-vowel-space">Plotting Significance of By-Factor Smooths in Vowel Space</h3>
<p>Here, I again copy the steps in the previous post. The only difference here is that we are going to have information about significance along with our predicted formant values.</p>
<p>We generate model predictions from each model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">to_predict <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb21-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1864</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># All years</span></span>
<span id="cb21-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span>
<span id="cb21-4">) </span>
<span id="cb21-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BTW: Get prediction will just assume the average value for any predictors not</span></span>
<span id="cb21-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mentioned (in this case, Speech_rate).</span></span>
<span id="cb21-7"></span>
<span id="cb21-8">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb21-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb21-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prediction =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb21-11">      model, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This time we're applying the function to all the models.</span></span>
<span id="cb21-12">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We again introduce the function with '~', and indicate where the model </span></span>
<span id="cb21-13">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># goes with '.x'.</span></span>
<span id="cb21-14">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_predictions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond =</span> to_predict, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print.summary =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb21-15">    )</span>
<span id="cb21-16">  )</span></code></pre></div>
</div>
<p>We then unnest the predictions, making sure to keep our p-value information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb22-3">    vowel, formant_type, genderF_smooth_pv, genderM_smooth_pv, prediction</span>
<span id="cb22-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb22-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(prediction)</span></code></pre></div>
</div>
<p>We still need to pivot our data so that we have distinct columns for the fit and the p-value for each formant type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">if_else</span>(gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, genderF_smooth_pv, genderM_smooth_pv)</span>
<span id="cb23-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded variables</span></span>
<span id="cb23-6">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>speech_rate,</span>
<span id="cb23-7">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CI,</span>
<span id="cb23-8">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>genderF_smooth_pv,</span>
<span id="cb23-9">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>genderM_smooth_pv</span>
<span id="cb23-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pivot</span></span>
<span id="cb23-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> formant_type,</span>
<span id="cb23-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit, p_value)</span>
<span id="cb23-14">  )</span></code></pre></div>
</div>
<p>Our significance test for each vowel is to test whether either of the p-values for the vowel is less than 0.025. We make a new column to track this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb24-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb24-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_sig =</span> (p_value_F1_lob2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> p_value_F2_lob2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>),</span>
<span id="cb24-4">  )</span></code></pre></div>
</div>
<p>Let’s have a look at which of these turn up as significant:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(vowel, gender) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_sig =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">first</span>(is_sig)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb25-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(is_sig)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'vowel'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
# Groups:   vowel [10]
   vowel   gender is_sig
   &lt;fct&gt;   &lt;fct&gt;  &lt;lgl&gt; 
 1 THOUGHT F      FALSE 
 2 DRESS   M      TRUE  
 3 DRESS   F      TRUE  
 4 FLEECE  M      TRUE  
 5 FLEECE  F      TRUE  
 6 GOOSE   M      TRUE  
 7 GOOSE   F      TRUE  
 8 KIT     M      TRUE  
 9 KIT     F      TRUE  
10 LOT     M      TRUE  
11 LOT     F      TRUE  
12 NURSE   M      TRUE  
13 NURSE   F      TRUE  
14 START   M      TRUE  
15 START   F      TRUE  
16 STRUT   M      TRUE  
17 STRUT   F      TRUE  
18 THOUGHT M      TRUE  
19 TRAP    M      TRUE  
20 TRAP    F      TRUE  </code></pre>
</div>
</div>
<p>Of our 10 vowels, the only one which does not come up as significant is <span class="smallcaps">thought</span> for the female speakers.</p>
<p>We will visualise significance in two ways. The first is to decrease the transparency of any vowel which does not meet our significance threshold, the second is to add to our vowel labels and indication of the p-values for F1 and F2 for each vowel. We’ll do this by adding a tag of the form ’(** | *)’ where the first set of stars indicates the magnitude of the F1 p-value and the second indicates the magnitude of the F2 p-value. We’ll use the usual stars for p-values. These can be conveniently generated using the <code>stars.pval</code> function from the <code>gtools</code> package.</p>
<p>We create the labels as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb28-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">F1_stars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stars.pval</span>(p_value_F1_lob2),</span>
<span id="cb28-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">F2_stars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stars.pval</span>(p_value_F2_lob2),</span>
<span id="cb28-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vowel_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb28-6">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{vowel}</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">({F1_stars}|{F2_stars})"</span></span>
<span id="cb28-7">    )</span>
<span id="cb28-8">  )</span></code></pre></div>
</div>
<p>Now we apply the static plot code from the previous post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">first_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(vowel, gender) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.min</span>(yob))</span>
<span id="cb29-4"></span>
<span id="cb29-5">static_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb29-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb29-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fit_F2_lob2,</span>
<span id="cb29-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> fit_F1_lob2,</span>
<span id="cb29-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> vowel,</span>
<span id="cb29-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> vowel_label,</span>
<span id="cb29-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> is_sig</span>
<span id="cb29-13">    )</span>
<span id="cb29-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(</span>
<span id="cb29-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make arrows smaller</span></span>
<span id="cb29-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb29-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb29-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> first_obs, </span>
<span id="cb29-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb29-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make labels small,</span></span>
<span id="cb29-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb29-24">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># less expanasion needed.</span></span>
<span id="cb29-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FALSE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TRUE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb29-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gender)</span>
<span id="cb29-30">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb29-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb29-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Lobanov 2.0)"</span>,</span>
<span id="cb29-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Lobanov 2.0)"</span></span>
<span id="cb29-35">  )</span>
<span id="cb29-36"></span>
<span id="cb29-37">static_plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/onze-sig-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ONZE by-gender smooths, with significance indicated.</figcaption>
</figure>
</div>
</div>
</div>
<p>The plot here creates somewhat unwieldy labels. The advantage of these is that they give us a bit more detail than merely ‘is significant’ or ‘is not significant’. This is particularly important given that these plots will typically be used in exploratory rather than confirmatory contexts. It is <em>also</em> important that we provide some indication of the specific p-values. Those which are near 0.05 should be treated with a bit of scepticism.</p>
<p>And now, the same plot but animated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">onze_anim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb30-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb30-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fit_F2_lob2,</span>
<span id="cb30-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> fit_F1_lob2,</span>
<span id="cb30-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> vowel,</span>
<span id="cb30-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> vowel_label,</span>
<span id="cb30-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> is_sig</span>
<span id="cb30-9">    )</span>
<span id="cb30-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># NB: our labels just use the predictions dataframe now, so no need for the</span></span>
<span id="cb30-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 'data = ' line.</span></span>
<span id="cb30-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>( </span>
<span id="cb30-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb30-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb30-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb30-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb30-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gender)</span>
<span id="cb30-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb30-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb30-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Lobanov 2.0)"</span>,</span>
<span id="cb30-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Lobanov 2.0)"</span>,</span>
<span id="cb30-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Year of Birth: {round(frame_along, 0)}'</span> </span>
<span id="cb30-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb30-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb30-31">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition_reveal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">along =</span> yob)</span>
<span id="cb30-33"></span>
<span id="cb30-34"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">animate</span>(onze_anim, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_pause =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/unnamed-chunk-17-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here the transparent applies to both the labels <em>and</em> the paths.</p>
<p>You might think that we should be applying some kind of multiple comparisons correction for the fact we are looking at 20 distinct statistical models! That would be the case if we were testing the hypothesis that there is some significant effect in <em>one</em> of the vowels we are looking at. I’d suggest that that is not an interesting hypothesis! What we’re trying to get at with these tools is a sense of systematic change in the data. If we wanted to turn this into a severe hypothesis test, we would need a much more worked out hypothesis which covered both <em>which</em> vowels we expect to have significant effects in the vowel space and <em>what</em> we expect those effects to be.</p>
</section>
<section id="p-values-for-difference-smooths" class="level3">
<h3 class="anchored" data-anchor-id="p-values-for-difference-smooths">P-Values for Difference Smooths</h3>
<p>If we want to know whether differences between the trajectories are significant, then we need a different model structure. Rather than fitting distinct smooths to the two levels of our gender variable, we need to fit a smooth for the female speakers and a <em>difference</em> smooth for the males. This smooth represents, as the name suggests, the difference between the shapes of the smooths for the male and female speakers.</p>
<p>The difference smooth structure is implemented by <code>mgcv</code> when we use ordered factors with contrast-treatment coding. This is done in R as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1">onze_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb33-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">gender =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.ordered</span>(gender)</span>
<span id="cb33-4">  )</span>
<span id="cb33-5"></span>
<span id="cb33-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">contrasts</span>(onze_data<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>gender) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'contr.treatment'</span></span></code></pre></div>
</div>
<p>We also have to change the model structure slightly. The difference between the needed model structure the structure used for by-factor smooths is that with difference smooths on a variable <img src="https://latex.codecogs.com/png.latex?x"> by some factor <img src="https://latex.codecogs.com/png.latex?y">, the model formula looks like <code>y + s(x) + s(x, by=y)</code> whereas if a smooth is fit to each level of the factor <img src="https://latex.codecogs.com/png.latex?y"> independently the formula looks like <code>y + s(x, by=y)</code>. The former structure is not actually <a href="https://en.wikipedia.org/wiki/Identifiability">identifiable</a> if you do not have contrast coded ordered factors. It’s important to be clear whether you are fitting by-factor level smooths or difference smooths!</p>
<p>We fit new models. Here, to avoid the models dataframe exploding, I’ll just replace the old ones. In a real research project, you will probably want to save the original models before you do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-2">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rerun the nesting steps.</span></span>
<span id="cb34-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb34-4">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> F1_lob2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>F2_lob2,</span>
<span id="cb34-5">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"formant_type"</span>,</span>
<span id="cb34-6">     <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"formant_value"</span></span>
<span id="cb34-7">   ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(vowel, formant_type) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb34-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rerun modelling with new structure</span></span>
<span id="cb34-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb34-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb34-13">      data,</span>
<span id="cb34-14">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bam</span>(</span>
<span id="cb34-15">        formant_value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(yob) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(yob, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> gender) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># main effects</span></span>
<span id="cb34-16">          <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(speech_rate) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># control variable</span></span>
<span id="cb34-17">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(speaker, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'re'</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(word, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bs =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"re"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># random effects</span></span>
<span id="cb34-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .x,</span>
<span id="cb34-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">discrete =</span> T,</span>
<span id="cb34-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nthreads =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span> </span>
<span id="cb34-21">      )</span>
<span id="cb34-22">    )</span>
<span id="cb34-23">  )</span></code></pre></div>
</div>
<p>We skip checking the model assumptions here. The same points as above apply.</p>
<p>Let’s have a look at a model summary for the same example as before (<span class="smallcaps">fleece</span>) F1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[model_index]])</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
formant_value ~ gender + s(yob) + s(yob, by = gender) + s(speech_rate) + 
    s(speaker, bs = "re") + s(word, bs = "re")

Parametric coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.03295    0.02509  -41.17  &lt; 2e-16 ***
genderM     -0.15884    0.02947   -5.39 7.19e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                   edf  Ref.df      F p-value    
s(yob)           2.093   2.180 45.640  &lt;2e-16 ***
s(yob):genderM   2.072   2.161  1.415   0.274    
s(speech_rate)   1.000   1.000  2.034   0.154    
s(speaker)      74.459  96.000  7.253  &lt;2e-16 ***
s(word)        215.736 734.000  1.969  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.221   Deviance explained =   24%
fREML =  10133  Scale est. = 0.30672   n = 11896</code></pre>
</div>
</div>
<p>The story we tell here is a bit different than the one we offered above. We have to account for both the parametric terms and the smooth terms. In the parametric coefficients, we see that the female speakers have an average F1 of -1.03295 in our Lobanov 2.0 normalised values. The <code>genderM</code> coefficient tells us that the male speakers have a value of which is smaller than the female speakers by 0.15884. That is, the male average is -1.19179. That is, in terms of the vowel space, their average <span class="smallcaps">fleece</span> vowel is higher.</p>
<p>The smooth terms then tell us about the shape of the change in male and female speakers over time. We see that <code>s(yob)</code>, the smooth for female speakers, is ‘statistically significant’. That is, there is change over time in this variable for our female speakers. The coefficient <code>s(yob):genderM</code> now indicates the difference in shape of the change over time between our female and male speakers. It is <em>not</em> statistically significant in this case. That is, the <em>shape</em> of the change over time could be the same for both speakers. This is quite different from the interpretation of <code>s(yob):genderM</code> in our previous model structure.</p>
<p>This case is interesting in that it looks intuitively from the animation in the previous section, that female speakers are leading the change in the height of <span class="smallcaps">fleece</span>, with the male speakers following after a delay. The model, however, is representing this as males being across-the-board higher in their <span class="smallcaps">fleece</span> vowel, while potentially following the same shape as the female speakers.</p>
<p>When thinking about change over time in the vowel space, we might be interested in differences in <em>shape</em> between men and women but not in across-the-board differences in height. With that in mind, we can plot those trajectories which have significant differences in shape across male and female speakers.</p>
<p>Following the same pattern as above, we say that a vowel has a significant difference in shape between male and female speakers if one or the other formant values has an <code>s(yob):genderM</code> p-value less than 0.0025. We follow the previous steps without much comment:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb37-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff_smooth_pv =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_dbl</span>(</span>
<span id="cb37-4">      model,</span>
<span id="cb37-5">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(.x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>s.pv[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb37-6">    )</span>
<span id="cb37-7">  )</span>
<span id="cb37-8"></span>
<span id="cb37-9">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb37-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prediction =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb37-12">      model, </span>
<span id="cb37-13">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_predictions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond =</span> to_predict, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print.summary =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb37-14">    )</span>
<span id="cb37-15">  )</span>
<span id="cb37-16"></span>
<span id="cb37-17">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb37-19">    vowel, formant_type, diff_smooth_pv, prediction</span>
<span id="cb37-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(prediction)</span>
<span id="cb37-22"></span>
<span id="cb37-23">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded variables</span></span>
<span id="cb37-25">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>speech_rate,</span>
<span id="cb37-26">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CI</span>
<span id="cb37-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pivot</span></span>
<span id="cb37-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> formant_type,</span>
<span id="cb37-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(fit, diff_smooth_pv)</span>
<span id="cb37-31">  )</span>
<span id="cb37-32"></span>
<span id="cb37-33">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb37-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb37-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">is_sig =</span> (diff_smooth_pv_F1_lob2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> diff_smooth_pv_F2_lob2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>),</span>
<span id="cb37-36">  )</span></code></pre></div>
</div>
<p>We now create labels and produce the static plot. Code which is changed from above is indicated in comments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb38-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">F1_stars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stars.pval</span>(diff_smooth_pv_F1_lob2),</span>
<span id="cb38-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">F2_stars =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">stars.pval</span>(diff_smooth_pv_F2_lob2),</span>
<span id="cb38-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vowel_label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb38-6">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{vowel}</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">({F1_stars}|{F2_stars})"</span></span>
<span id="cb38-7">    )</span>
<span id="cb38-8">  )</span>
<span id="cb38-9"></span>
<span id="cb38-10">first_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(vowel, gender) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.min</span>(yob))</span>
<span id="cb38-13"></span>
<span id="cb38-14">static_plot <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb38-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb38-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb38-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fit_F2_lob2,</span>
<span id="cb38-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> fit_F1_lob2,</span>
<span id="cb38-19">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> vowel,</span>
<span id="cb38-20">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> vowel_label,</span>
<span id="cb38-21">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> is_sig</span>
<span id="cb38-22">    )</span>
<span id="cb38-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(</span>
<span id="cb38-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make arrows smaller</span></span>
<span id="cb38-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb38-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb38-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> first_obs, </span>
<span id="cb38-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb38-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make labels small</span></span>
<span id="cb38-32">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">### NB: alpha removed from here - labels will change transparency as well</span></span>
<span id="cb38-33">    <span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## as paths.</span></span>
<span id="cb38-34">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># less expanasion needed.</span></span>
<span id="cb38-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FALSE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TRUE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb38-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gender)</span>
<span id="cb38-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb38-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb38-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb38-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Significant Shape Difference Between Genders"</span>,</span>
<span id="cb38-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Lobanov 2.0)"</span>,</span>
<span id="cb38-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Lobanov 2.0)"</span></span>
<span id="cb38-46">  )</span>
<span id="cb38-47"></span>
<span id="cb38-48">static_plot</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/onze-diff-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>ONZE smooths, with significant gender differences indicated.</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure (fig:onze-diff-plot) suggests that there are significant differences in the shape of change between the male and female speakers for <span class="smallcaps">nurse</span>, <span class="smallcaps">goose</span>, abd <span class="smallcaps">thought</span>.</p>
<p>This can be converted into an animated plot using the same approach as for the animated plot in the previous section.</p>
</section>
<section id="pointwise-significance-of-difference-smooths" class="level3">
<h3 class="anchored" data-anchor-id="pointwise-significance-of-difference-smooths">Pointwise Significance of Difference Smooths</h3>
<p>The p-values in the summaries of difference smooth models provide a sense of whether the appropriate smooth for two levels of a factor differ in shape and <em>overall</em>. We might, instead, be interested in a pointwise, or even range-wise, sense of significance. In this case, we might ask if the smooths for men and women are significantly different for speakers born between 1860-1880 or between 1900-1920 etc. This is closely related to the visual method of significance testing which Sóskuthy expresses some caution about.</p>
<p>The method is simply to look at the plot of the smooths for each factor level in a difference smooth model and, if there is a point where their confidence intervals separate, to declare the difference significant. Sóskuthy advises that we only do this if we have a concrete hypothesis about the range in which the smooths will differ. If not, we open the door to an unacceptable number of false positives. (A second version of this approach looks at a plot of the difference between the two and looks for ranges in which 0 is not included within the confidence interval).</p>
<p>This caution is certainly important in a confirmatory setting. Here, in an exploratory setting, we can just be aware that we shouldn’t expend energy trying to interpret pointwise differences between two smooths. This is easy enough to avoid if we keep in mind our actual subject matter! If there are two years in our data in which men and women has a ‘significant’ difference between their smooths, say 1872 and 1873, we are not going to rush to the journals with a paper on the sociolinguistics of gender difference in 1872 and 1873. We just don’t expect that kind of resolution from this data and these methods of analysis.</p>
<p>One final note about this method is that it includes both the shape <em>and</em> the intercept terms. Two smooths which are identical in shape but are vertical translations of one another and do not have overlapping confidence intervals will appear as significantly different across their whole range.</p>
<p>The aim in this (final!) section will be to show how to extract ‘significantly different’ ranges from our smooths and to plot them in the vowel space. The core idea is to use the <code>get_difference</code> function from the <code>itsadug</code> package, which returns the difference smooth and its confidence intervals.</p>
<p>Let’s look at this function for the <span class="smallcaps">fleece</span> F1 model. First, it will be useful to see the difference smooth itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_diff</span>(</span>
<span id="cb39-2">  onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[model_index]],</span>
<span id="cb39-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">view =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span>,</span>
<span id="cb39-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>))</span>
<span id="cb39-5">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary:
    * yob : numeric predictor; with 100 values ranging from 1864.000000 to 1981.000000. 
    * speech_rate : numeric predictor; set to the value(s): 4.5576. 
    * speaker : factor; set to the value(s): IA_f_527. (Might be canceled as random effect, check below.) 
    * word : factor; set to the value(s): word_12921. (Might be canceled as random effect, check below.) 
    * NOTE : The following random effects columns are canceled: s(speaker),s(word)
 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
yob window(s) of significant difference(s):
    1877.000000 - 1981.000000</code></pre>
</div>
</div>
<p>The above plot shows the difference between female and male speakers in their smooths for <span class="smallcaps">fleece</span> F1. The red line indicates the range of years of birth for which the two are taken to be significantly different.</p>
<p>The <code>get_difference</code> function helps us to find these ranges directly. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">to_predict <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb42-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1864</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># All years</span></span>
<span id="cb42-3">) </span>
<span id="cb42-4"></span>
<span id="cb42-5">fleece_difference_smooth <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_difference</span>(</span>
<span id="cb42-6">  onze_models<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[model_index]],</span>
<span id="cb42-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond =</span> to_predict,</span>
<span id="cb42-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>))</span>
<span id="cb42-9">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary:
    * yob : numeric predictor; with 118 values ranging from 1864.000000 to 1981.000000. 
    * speech_rate : numeric predictor; set to the value(s): 4.5576. 
    * speaker : factor; set to the value(s): IA_f_527. (Might be canceled as random effect, check below.) 
    * word : factor; set to the value(s): word_12921. (Might be canceled as random effect, check below.) 
    * NOTE : The following random effects columns are canceled: s(speaker),s(word)
 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1">fleece_difference_smooth <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb44-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If the estimate for the difference smooth minus the confidence interval</span></span>
<span id="cb44-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># value is greater than 0 or the difference smooth plus the confidence</span></span>
<span id="cb44-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># interval value is less than 0, then the confidence band does not include</span></span>
<span id="cb44-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0. In this case, the difference at that point is 'significant'.</span></span>
<span id="cb44-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sig_diff =</span> (difference <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> CI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (difference <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> CI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb44-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb44-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    yob speech_rate  speaker       word difference        CI sig_diff
1  1864      4.5576 IA_f_527 word_12921 0.05790359 0.1414914    FALSE
2  1865      4.5576 IA_f_527 word_12921 0.06196859 0.1375988    FALSE
3  1866      4.5576 IA_f_527 word_12921 0.06603054 0.1338369    FALSE
4  1867      4.5576 IA_f_527 word_12921 0.07008477 0.1302179    FALSE
5  1868      4.5576 IA_f_527 word_12921 0.07412524 0.1267523    FALSE
6  1869      4.5576 IA_f_527 word_12921 0.07814509 0.1234480    FALSE
7  1870      4.5576 IA_f_527 word_12921 0.08213722 0.1203095    FALSE
8  1871      4.5576 IA_f_527 word_12921 0.08609447 0.1173372    FALSE
9  1872      4.5576 IA_f_527 word_12921 0.09000985 0.1145281    FALSE
10 1873      4.5576 IA_f_527 word_12921 0.09387715 0.1118768    FALSE
11 1874      4.5576 IA_f_527 word_12921 0.09769055 0.1093757    FALSE
12 1875      4.5576 IA_f_527 word_12921 0.10144559 0.1070174    FALSE
13 1876      4.5576 IA_f_527 word_12921 0.10513947 0.1047953     TRUE
14 1877      4.5576 IA_f_527 word_12921 0.10877103 0.1027050     TRUE
15 1878      4.5576 IA_f_527 word_12921 0.11234046 0.1007440     TRUE</code></pre>
</div>
</div>
<p>The above output gives the first 15 rows, and shows that the significant difference between smooths starts in 1876.</p>
<p>To apply the function to all models we use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1">onze_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb46-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sig_diffs =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb46-4">      model,</span>
<span id="cb46-5">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_difference</span>(</span>
<span id="cb46-6">          .x,</span>
<span id="cb46-7">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond =</span> to_predict,</span>
<span id="cb46-8">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comp =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>)),</span>
<span id="cb46-9">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print.summary =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb46-10">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-11">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb46-12">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sig_diff =</span> (difference <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> CI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (difference <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> CI) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb46-13">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb46-14">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(yob, sig_diff)</span>
<span id="cb46-15">    )</span>
<span id="cb46-16">  )</span></code></pre></div>
</div>
<p>We want to take the years and whether the difference is significant for each model. We do this by unnesting in much the same way that we generated <code>onze_predictions</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">onze_sig_diffs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb47-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb47-3">    vowel, formant_type, sig_diffs</span>
<span id="cb47-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb47-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(sig_diffs)</span></code></pre></div>
</div>
<p>We then need to aggregate these ranges so that a difference appears as significant in the vowel space plot if either the F1 or the F2 smooths are significantly different across genders.</p>
<p>This is done as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1">onze_sig_diffs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_sig_diffs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb48-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> formant_type,</span>
<span id="cb48-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> sig_diff</span>
<span id="cb48-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb48-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sig_diff =</span> F1_lob2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> F2_lob2</span>
<span id="cb48-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb48-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb48-10">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(F1_lob2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>F2_lob2)</span>
<span id="cb48-11">  )</span></code></pre></div>
</div>
<p>Since we already have predictions from these models from the previous section, I’ll add this information about significant ranges by using <code>left_join</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">onze_predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb49-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">left_join</span>(</span>
<span id="cb49-3">    onze_sig_diffs</span>
<span id="cb49-4">  )</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(vowel, yob)`</code></pre>
</div>
</div>
<p>Finally, we plot. In this case, we’ll go straight to the animated plot. The basic idea will be to have low transparency when differences significant and high transparency when they are not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1">onze_diff_anim <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb51-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb51-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb51-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> fit_F2_lob2,</span>
<span id="cb51-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> fit_F1_lob2,</span>
<span id="cb51-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> vowel,</span>
<span id="cb51-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> sig_diff,</span>
<span id="cb51-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> vowel,</span>
<span id="cb51-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> vowel,</span>
<span id="cb51-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> sig_diff</span>
<span id="cb51-11">    )</span>
<span id="cb51-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># NB: our labels just use the predictions dataframe now, so no need for the</span></span>
<span id="cb51-15">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 'data = ' line.</span></span>
<span id="cb51-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb51-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb51-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span></span>
<span id="cb51-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb51-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_alpha_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'FALSE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TRUE'</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FALSE"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRUE"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb51-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(gender)</span>
<span id="cb51-26">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb51-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb51-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Significant Differences Between Gender Smooths"</span>,</span>
<span id="cb51-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Lobanov 2.0)"</span>,</span>
<span id="cb51-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Lobanov 2.0)"</span>,</span>
<span id="cb51-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Year of Birth: {round(frame_along, 0)}</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> Grey indicates non-significant differences between male and</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;"> female smooths.'</span> </span>
<span id="cb51-33">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb51-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb51-36">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb51-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition_reveal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">along =</span> yob)</span>
<span id="cb51-38"></span>
<span id="cb51-39"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">animate</span>(onze_diff_anim, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end_pause =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/index_files/figure-html/unnamed-chunk-28-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>It remains to be seen how useful this kind of plot is for interpreting vowel space change. In this case, for many vowels we seem to start with insignificant difference, enter a long period of change, and, for many vowels, end up with insignificant differences. This would have to be distinguished from the fact that confidence intervals tend to flare out at the extremes of smooths.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This post has expanded on my previous post on fitting independent models to the F1 and F2 data of multiple vowels using the nest and mutate approach of the <code>purrr</code> package. I’ve covered something of how to check the health of each of the models and how to extract information about whether the difference between two smooths is significant using some of the methods mentioned in <a href="https://www.sciencedirect.com/science/article/pii/S009544702030108X">Sóskuthy (2021)</a>. In particular, we have followed his advice about the use of <em>difference smooths</em> and the use of the Bonferroni correction.</p>


</section>

 ]]></description>
  <category>GAMMs</category>
  <category>vowels</category>
  <category>sociolinguistics</category>
  <guid>https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/</guid>
  <pubDate>Mon, 29 Aug 2022 12:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/significance-testing-for-vowel-space-gamms/feature.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Organising Shareable R Projects</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/organising-r-projects/</link>
  <description><![CDATA[ 




<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>A complex research project can easily get out of hand organisationally. Sometimes we end up with multiple folders with different data sets, models, plots, scripts, and R Markdown files. This can become <em>deeply</em> confusing as we work. We want our projects to be <strong>well structured</strong>.</p>
<p>We also want our work to be <strong>shareable</strong>. Often newcomers to R produce files which depend on their own directory structure. A tell tale sign is a line of code like: <code>my_data &lt;- read_rds('/home/jane_doe/Documents/my_project/data/third_attempt/data_2.rds)</code>. This will cause problems for anyone trying to run the code on a different computer.</p>
<p>The demand for well structured and shareable projects is doubly true if we want to make our data and analysis public by means of a GitHub or GitLab repository.</p>
<p>Having read a few blog posts and text book sections, I’ve ended up fixing on the following set up for my projects at NZILBB. This post assumes you are using RStudio.</p>
</section>
<section id="directory-structure" class="level2">
<h2 class="anchored" data-anchor-id="directory-structure">Directory Structure</h2>
<p>The structure I recommend looks like this:</p>
<pre><code>project_name
| README.md
| project_name.Rproj
|
└─── data
|   | raw_data.csv
|   | processed_data.rds
|   | ...
|
└─── supplementaries
|   | preprocessing.Rmd
|   | modelling.Rmd
|   | ...
|
└─── presentations
|   └─── conference_name
|       | presentation.Rmd
|       | ...
|
└─── write_up
|   | write_up.Rmd
|   | ...
|
└─── scripts
|   | anonymisation.R
|   | ...
|
└─── models
|   | model_name.rds
|   | ...
|
└─── plots
    | data_distribution.png
    | model_predictions.png
    | ...
</code></pre>
<p>The names of the files inside the folders above are illustrative examples.</p>
<p>In a file explorer, It’ll look like this: <img src="https://joshua.wilsonblack.nz/posts/organising-r-projects/browser.png" class="img-fluid"></p>
<p>The idea is to have a folder for each project. Within that folder, you will always have a <code>data</code> folder within which you should store all of your data files. Sometimes I distinguish between a <em>raw</em> data folder and one with data which has been processed as part of the project. This is not necessary though.</p>
<p>The majority of the R code which you will create will be in the <code>supplementaries</code> and <code>scripts</code> folders. I like to keep these separate, rather than having a single <code>scripts</code> folder for all <code>.R</code> and <code>.Rmd</code> files. This is because I tend to end up with lots of small scripts which respond to small projects which occur in the course of a project or which are prototypes of an analysis which will eventually appear in an R markdown document. The <code>scripts</code> folder can hold this, potentially messy, material. The <code>supplementaries</code> on the other hand, will be the main R markdown file containing the analysis code and any descriptions needed for someone to make sense of the steps you have carried out.</p>
<p>The R markdown files in the <code>supplementaries</code> folder will likely include much more than you report in any papers you produce from the project. In order to avoid unwieldy R markdown files which take a long time to knit, I like to have a distinct file for each major step in the project.</p>
<p>We often save plots in the course of our analysis. It is useful to have these in a <code>plots</code> folder. These can then be independently shared or used with other programmes.</p>
<p>In projects which handle large data sets, it is often wise to save any models we have fit to the data. These models can sometimes take hours to fit. This avoids wasting time refitting models. We put these files in the <code>models</code> folder.</p>
<p>The remaining folders in the structure above are optional. I often create presentations using the <a href="https://bookdown.org/yihui/rmarkdown/xaringan.html"><code>Xaringan</code></a> or <a href="https://bookdown.org/yihui/rmarkdown/ioslides-presentation.html"><code>ioslides</code></a> packages. I store these in a <code>presentations</code> directory. Sometimes I include a <code>write_up</code> folder for any journal articles or other written outputs which might come from the project.</p>
<p>within the project folder, you should have a file called <code>README.md</code>. This is a markdown file which should explain <em>what</em> your project is, <em>where</em> things are stored within the project, and <em>how</em> the project can be interacted with. If you use GitHub or GitLab, the content of this file will be the first thing that any potential user will see of your project.</p>
<p>What about the <code>project_name.Rproj</code> file? We’ll turn to that now.</p>
</section>
<section id="r-project-files-and-the-here-package" class="level2">
<h2 class="anchored" data-anchor-id="r-project-files-and-the-here-package">R Project Files and the <code>here</code> Package</h2>
<p>The main problem which R project files and the <code>here</code> package solve is file path management.</p>
<p>There are two options for starting a new project in RStudio: starting a project in an already existing directory or by creating a new directory. Both options will be given to you if you open RStudio and click the ‘project’ button at the top right of your screen and select ‘New Project…’. Either option is perfectly fine.</p>
<p>Once you have created a project you should see the name you have chosen at the top right of the screen. Your project folder, whether it already existed or you just created it, will also have a file with your project name and the extension <code>.Rproj</code>. This is the R project file. You can use this to open your project (just double click on it).</p>
<p>Once the project is opened, your working directory will be the project folder. This is already an improvement on getting and setting working directories with absolute file paths at the start of an R script. Anyone you send the project to will, if they open through the project file, be in the right place on their own machine to run your code. If you use relative file paths, this is a big improvement. That is, if you use e.g.&nbsp;<code>read_csv('data/my_data.csv')</code> from an R script in your project folder, this will work for anyone who you share your project with.</p>
<p>The <code>here</code> package takes us even further, though. As <a href="http://jenrichmond.rbind.io/post/how-to-use-the-here-package/">Jenny Richmond sets out</a>, working directories work a little differently for R scripts and R markdown files. If you have a script and an Rmd file in <code>project_name/markdown</code>, the working directory for the R script will be the project folder, while the working directory for the R markdown file will be <code>project_name/markdown</code>. This means, for instance, that code which works in your markdown file will not work in the R console. It’s also something which you would have to keep in your head when moving between R scripts and R markdown files. This is not the kind of thing you want to be worrying about.</p>
<p>If you load the package <code>here</code> when working in a project, you can refer to files within your project in a consistent way which does not depend on anything specific to your own computer. For example:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb2-2">my_data <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'data'</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'my_data.csv'</span>))</span></code></pre></div>
<p>This code will load the package <code>here</code>, which looks ‘up’ the directory structure until it finds the R project file. We then use the function <code>here</code> to refer to files within our project. The arguments to <code>here</code> are either folders or files. A number of arguments specifying folders are followed by an argument with the name of the specific file to be loaded. In this case, <code>'data'</code> is the first argument, which says we are looking in the data folder inside our project folder. The second argument, <code>'my_data.csv'</code> says that we are looking for a file with that name <em>inside</em> the folder specified by the previous argument.</p>
<p>To belabour the point a bit: if the file we want to load is two folders deep, say, the file <code>my_data.csv</code> is inside a folder called <code>data_source_1</code> which is in turn inside out <code>data</code> folder, then we would use <code>here('data', 'data_source_1</code>, <code>my_data.csv</code>). You can have as many arguments as you like when using the <code>here</code> function.</p>
<p>A final note: in a footnote to the <code>here</code> package documentation it is suggested to avoid <code>library(here)</code> and instead use <code>here::here()</code> whenever you use the <code>here</code> function. I can see that this avoids clashes with the <code>here</code> function in the <code>plyr</code> package, but I don’t see this as likely to come up in any of my work or in NZILBB projects.</p>
</section>
<section id="sharing-code" class="level2">
<h2 class="anchored" data-anchor-id="sharing-code">Sharing Code</h2>
<p>There are two main code sharing scenarios:</p>
<ol type="1">
<li>Sharing a whole project.</li>
<li>Sharing a small portion of a project.</li>
</ol>
<p>In the former case, the best option is Git, along with either GitHub or GitLab. This does have a bit of a learning curve (but <a href="https://happygitwithr.com/">it’s not insurmountable</a>)!</p>
<p>Otherwise, for either case, use whatever method you’d usually use to share files with someone. Either send the whole project folder, or the project folder without unnecessary files. Sometimes, it might be easier to start a <em>new</em> project and create a minimal working example of whatever it is you want to share.</p>
</section>
<section id="futher-reading" class="level2">
<h2 class="anchored" data-anchor-id="futher-reading">Futher reading</h2>
<ul>
<li>Bodo Winters, <a href="https://www.taylorfrancis.com/books/mono/10.4324/9781315165547/statistics-linguists-introduction-using-bodo-winter"><em>Statistics for Linguists: An Introduction Using R</em></a>
<ul>
<li>See Chapter 2, which covers the core <code>tidyverse</code> packages with a worked example from linguistics <em>and</em> introduces a folder structure similar to the one suggested here in Section 2.8. Winters doesn’t cover the <code>here</code> package.</li>
</ul></li>
<li>Hadley Wichkam, <a href="https://r4ds.had.co.nz/workflow-projects.html"><em>Advanced R</em>, Chapter 8 Workflow: Projects</a>.
<ul>
<li>Some advice for setting up Rstudio to encourage good habits and reasons for using R projects to organise code.</li>
</ul></li>
<li>Jenny Richmond, <a href="http://jenrichmond.rbind.io/post/how-to-use-the-here-package/">‘how to use the <code>here</code> package`’</a></li>
<li>Malcolm Barrett, <a href="https://malco.io/2018/11/05/why-should-i-use-the-here-package-when-i-m-already-using-projects/">‘Why should I use the here package when I’m already using projects?’</a></li>
</ul>
<p>If you want to know more about Git and Github for code sharing and version management check out <a href="https://happygitwithr.com/">Happy Git and GitHub for the useR</a></p>


</section>

 ]]></description>
  <category>linguistics</category>
  <category>sociolinguistics</category>
  <category>data science</category>
  <guid>https://joshua.wilsonblack.nz/posts/organising-r-projects/</guid>
  <pubDate>Sun, 31 Jul 2022 12:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/organising-r-projects/feature.png" medium="image" type="image/png" height="106" width="144"/>
</item>
<item>
  <title>A 3D PCA Visualisation with Plotly</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/plotly-struggles/</link>
  <description><![CDATA[ 




<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>I am attempting to build a nice illustrative example of PCA which shows how it can produce interpretable, lower-dimensional representations of vowel formant data.</p>
<p>One <a href="https://towardsdatascience.com/pca-principal-component-analysis-explained-visually-in-5-minutes-20ce8a9ebf0f">well</a>-<a href="https://towardsdatascience.com/principal-component-analysis-pca-explained-visually-with-zero-math-1cbf392b9e7d">trodden</a> <a href="https://machinelearningmastery.com/principal-component-analysis-for-visualization/">method</a> of showing how PCA works is to start with three dimensions and go down to two dimensions.</p>
<p>Heavy use of <code>ggplot2</code> for the last year and a half has worn deep grooves into my brain. But <code>ggplot2</code> does not offer options for 3D plots.</p>
<p>A few extension packages exist to extend <code>ggplot</code> into three dimensions, but nothing stood out to me as I was looking around. I have also wanted to explore <code>plotly</code> a little more after playing around with <code>plotly</code> cytoscapes for <a href="https://nz-newspaper-philosophy.herokuapp.com/">another project</a>.</p>
<p>The following example, which will be used for a larger project on PCA in the study of vowel covariation, took far more work than anticipated. I’ll present it in the next section and then run through some of the problems which occurred for me.</p>
</section>
<section id="a-plotly-example" class="level2">
<h2 class="anchored" data-anchor-id="a-plotly-example">A Plotly Example</h2>
<p>Here’s the code, with the Plotly interactive following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(plotly)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reorganising data</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'onze_means.rda'</span>)</span>
<span id="cb1-7"></span>
<span id="cb1-8">onze_sub <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_means <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb1-10">    vowel <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DRESS"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"KIT"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRAP"</span>)</span>
<span id="cb1-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb1-13">    speaker, vowel, F1_50, yob, gender</span>
<span id="cb1-14">  )</span>
<span id="cb1-15"></span>
<span id="cb1-16">onze_to_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_sub <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> vowel,</span>
<span id="cb1-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> F1_50</span>
<span id="cb1-20">  )</span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Running PCA</span></span>
<span id="cb1-23"></span>
<span id="cb1-24">onze_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prcomp</span>(</span>
<span id="cb1-25">  onze_to_pca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(DRESS, KIT, TRAP),</span>
<span id="cb1-26">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-27">)</span>
<span id="cb1-28"></span>
<span id="cb1-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extracting PCA information</span></span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load scores for individuals (contained in onze_pca$x)</span></span>
<span id="cb1-32">onze_to_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_to_pca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC1 =</span> onze_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb1-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC2 =</span> onze_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x[, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb1-36">  )</span>
<span id="cb1-37"></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract centre. This will be used in the plot.</span></span>
<span id="cb1-39">pca_center <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>center</span>
<span id="cb1-40"></span>
<span id="cb1-41">center_tibble <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-42">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DRESS"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb1-43">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"KIT"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]],</span>
<span id="cb1-44">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRAP"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]]</span>
<span id="cb1-45">)</span>
<span id="cb1-46"></span>
<span id="cb1-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract loadings.</span></span>
<span id="cb1-48">pca_loadings <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_pca<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>rotation</span>
<span id="cb1-49"></span>
<span id="cb1-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use the loadings and centre to find where each point sits along PC1 and PC2</span></span>
<span id="cb1-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># when represented in the original 3D space.</span></span>
<span id="cb1-52">onze_to_pca <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> onze_to_pca <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb1-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC1_DRESS =</span> (PC1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb1-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC1_KIT =</span> (PC1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]],</span>
<span id="cb1-56">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC1_TRAP =</span> (PC1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]],</span>
<span id="cb1-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC2_DRESS =</span> (PC2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb1-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC2_KIT =</span> (PC2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]],</span>
<span id="cb1-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PC2_TRAP =</span> (PC2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pca_loadings[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> pca_center[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]],</span>
<span id="cb1-60">  )</span>
<span id="cb1-61"></span>
<span id="cb1-62"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Visualisation</span></span>
<span id="cb1-63"></span>
<span id="cb1-64">fig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_ly</span>(</span>
<span id="cb1-65">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> onze_to_pca,</span>
<span id="cb1-66">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>DRESS,</span>
<span id="cb1-67">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>KIT,</span>
<span id="cb1-68">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>TRAP,</span>
<span id="cb1-69">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scatter3d"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># What kind of plot.</span></span>
<span id="cb1-70">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"markers"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># What kind of marking (something like geom in ggplot)</span></span>
<span id="cb1-71">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Speakers"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This label will go in the legend.</span></span>
<span id="cb1-72">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marker =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-73">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,</span>
<span id="cb1-74">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">opacity =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>,</span>
<span id="cb1-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>,</span>
<span id="cb1-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lines =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-77">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'black'</span>,</span>
<span id="cb1-78">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-79">    ),</span>
<span id="cb1-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">showlegend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-81">  )</span>
<span id="cb1-82">)</span>
<span id="cb1-83"></span>
<span id="cb1-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add title and axis labels</span></span>
<span id="cb1-85">fig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> fig <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-86">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">layout</span>(</span>
<span id="cb1-87">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-88">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span></span>
<span id="cb1-89">    ),</span>
<span id="cb1-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-91">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean KIT, DRESS, and TRAP F1 for 100 ONZE Speakers"</span>,</span>
<span id="cb1-92">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-93">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>,</span>
<span id="cb1-94">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Open Sans"</span></span>
<span id="cb1-95">      )</span>
<span id="cb1-96">    ),</span>
<span id="cb1-97">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scene =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-98">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-99">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DRESS F1 (Hz)"</span></span>
<span id="cb1-100">      ),</span>
<span id="cb1-101">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-102">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"KIT F1 (Hz)"</span></span>
<span id="cb1-103">      ),</span>
<span id="cb1-104">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-105">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRAP F1 (Hz)"</span></span>
<span id="cb1-106">      )</span>
<span id="cb1-107">    )</span>
<span id="cb1-108">  )</span>
<span id="cb1-109"></span>
<span id="cb1-110">fig <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> fig <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-111">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add centre mark</span></span>
<span id="cb1-112">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_trace</span>(</span>
<span id="cb1-113">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>DRESS,</span>
<span id="cb1-114">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>KIT,</span>
<span id="cb1-115">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>TRAP,</span>
<span id="cb1-116">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> center_tibble,</span>
<span id="cb1-117">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scatter3d'</span>,</span>
<span id="cb1-118">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'markers'</span>,</span>
<span id="cb1-119">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">marker =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-120">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb1-121">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">opacity =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-122">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'red'</span>,</span>
<span id="cb1-123">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">symbol =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span></span>
<span id="cb1-124">      ),</span>
<span id="cb1-125">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Center"</span>,</span>
<span id="cb1-126">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-127">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-128">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add PC1 line</span></span>
<span id="cb1-129">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_trace</span>(</span>
<span id="cb1-130">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> onze_to_pca,</span>
<span id="cb1-131">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC1_DRESS,</span>
<span id="cb1-132">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC1_KIT,</span>
<span id="cb1-133">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC1_TRAP,</span>
<span id="cb1-134">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scatter3d'</span>,</span>
<span id="cb1-135">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lines'</span>,</span>
<span id="cb1-136">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'PC1'</span>,</span>
<span id="cb1-137">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-138">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D55E00"</span>,</span>
<span id="cb1-139">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span>
<span id="cb1-140">    ),</span>
<span id="cb1-141">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-142">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-143">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add PC2 line.</span></span>
<span id="cb1-144">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_trace</span>(</span>
<span id="cb1-145">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> onze_to_pca,</span>
<span id="cb1-146">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC2_DRESS,</span>
<span id="cb1-147">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC2_KIT,</span>
<span id="cb1-148">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">z =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>PC2_TRAP,</span>
<span id="cb1-149">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'scatter3d'</span>,</span>
<span id="cb1-150">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mode =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'lines'</span>,</span>
<span id="cb1-151">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'PC2'</span>,</span>
<span id="cb1-152">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-153">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0072B2"</span>,</span>
<span id="cb1-154">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb1-155">    ),</span>
<span id="cb1-156">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">inherit =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-157">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-158">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">layout</span>(</span>
<span id="cb1-159">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scene =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-160">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-161">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"DRESS F1 (Hz)"</span></span>
<span id="cb1-162">      ),</span>
<span id="cb1-163">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-164">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"KIT F1 (Hz)"</span></span>
<span id="cb1-165">      ),</span>
<span id="cb1-166">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zaxis =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-167">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRAP F1 (Hz)"</span></span>
<span id="cb1-168">      )</span>
<span id="cb1-169">    )</span>
<span id="cb1-170">  )</span>
<span id="cb1-171"></span>
<span id="cb1-172">fig</span></code></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-04b7ce07d724def6a44e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-04b7ce07d724def6a44e">{"x":{"visdat":{"56913125c762":["function () ","plotlyVisDat"],"569127450c23":["function () ","data"],"5691261fe1f9":["function () ","data"],"5691772cb5fc":["function () ","data"]},"cur_data":"5691772cb5fc","attrs":{"56913125c762":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":2,"opacity":0.80000000000000004,"color":"gray","lines":{"color":"black","width":1},"showlegend":false},"name":"Speakers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"569127450c23":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"markers","marker":{"size":6,"opacity":1,"color":"red","symbol":"x"},"name":"Center","inherit":false},"5691261fe1f9":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines","name":"PC1","line":{"color":"#D55E00","width":6},"inherit":false},"5691772cb5fc":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines","name":"PC2","line":{"color":"#0072B2","width":4},"inherit":false}},"layout":{"margin":{"b":40,"l":60,"t":90,"r":10},"title":{"text":"Mean KIT, DRESS, and TRAP F1 for 100 ONZE Speakers","font":{"size":24,"family":"Open Sans"}},"scene":{"xaxis":{"title":"DRESS F1 (Hz)"},"yaxis":{"title":"KIT F1 (Hz)"},"zaxis":{"title":"TRAP F1 (Hz)"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[622.5797101449275,551.32824427480921,534.70000000000005,455.84259259259261,515.78082191780823,557.5090909090909,605.10344827586209,418.37096774193549,472.48979591836735,507.80000000000001,494.13178294573646,494.13636363636363,584.31645569620252,409.09433962264148,540.79279279279274,586.945652173913,431.28571428571428,581.79279279279274,593.76470588235293,482.75714285714287,493.54545454545456,500.82278481012656,466.89999999999998,469.5609756097561,497.8170731707317,451.1953125,474.27777777777777,562.18032786885249,516.45161290322585,451.74603174603175,380.25510204081633,541.18032786885249,439.87567567567567,386.63888888888891,466.85281385281388,483.66666666666669,455.55737704918033,521.05555555555554,473.74479166666669,433.59459459459458,359.23333333333335,530.81132075471703,511.469696969697,502.78571428571428,495.43617021276594,419.89887640449439,394.21875,364.9221105527638,417.45418326693226,516.90067720090292,532.10298102981028,609.52702702702697,498.3532338308458,476.78908188585609,603.21875,467.71882640586796,566.81200000000001,625.21951219512198,444.05050505050502,605.9655172413793,492.82482993197277,576.35420743639918,458.57602339181284,516.82575757575762,563.7117117117117,417.2823529411765,522.19395465994967,494.37068965517244,451.58755760368666,598.68589743589746,418.04166666666669,529.91327913279133,495.2641509433962,578.66141732283461,549.83127572016463,571.70192307692309,427.94029850746267,483.01249999999999,454.18181818181819,548.10298102981028,480.02459016393442,438.72463768115944,484.08653846153845,456.15909090909093,609.9045226130653,447.02064896755161,515.42168674698792,436.22413793103448,538.97814207650276,415.58620689655174,421.97674418604652,446.17460317460319,517.93193717277484,510.57727272727271,474.57894736842104,559,411.76397515527952,489.34375,447.8987341772152,460.88150289017341],"y":[646.82142857142856,622.24309392265195,588.84444444444443,525.05594405594411,567.83823529411768,634.79487179487182,664.02941176470586,495.58571428571429,450.16216216216219,631.92307692307691,614.05536332179929,566.15079365079362,652,465.53731343283584,619.81308411214957,673.52222222222224,547.71641791044772,602.23148148148152,656.7210884353741,541.60344827586209,541.46268656716416,508.58860759493672,469.64999999999998,485.9159663865546,504.47916666666669,481.49668874172187,589.25423728813564,559.66666666666663,535.14049586776855,464.55339805825241,404.94214876033055,539.36363636363637,487.09609609609612,391.29299363057322,484.39263803680984,504.87234042553189,465.2439024390244,555.49358974358972,479.54437869822488,489.71428571428572,396.73529411764707,532.8496240601504,533.63414634146341,520.9375,473.84438040345822,391.28491620111731,392.6543624161074,457.01168224299067,475.97719869706839,484.6875,484.59701492537312,535.66769230769228,472.04015296367112,490.62972292191438,569.02380952380952,447.387610619469,515.22488038277515,547.83333333333337,508.91389432485323,557.96296296296293,486.43364485981306,549.14773980154359,425.97326203208559,456.40441176470586,528.63617021276593,414.66244725738397,495.33578431372547,460.62459546925567,424.83447098976109,485.34193548387094,357.5,451.02908277404924,443.64583333333331,428.31034482758622,439.171875,418.57692307692309,367.55696202531647,428.38532110091745,393.04285714285714,405.04926108374383,366.22727272727275,398.88679245283021,394.95890410958901,397.30120481927713,452.44334975369458,375.44892473118279,395.25714285714287,405.74025974025972,405.89180327868854,348.2162162162162,354.04861111111109,387.40816326530614,430.47619047619048,417.1556886227545,388.51485148514854,439.57333333333332,338.1720930232558,374.92349726775956,382.22257053291537,378.08764940239041],"z":[637.86666666666667,669.13846153846157,629.56521739130437,579.07272727272732,623.69047619047615,657.5094339622641,662.29999999999995,486.36111111111109,531.9545454545455,668.38297872340422,628.33333333333337,565.7037037037037,691.07692307692309,551.625,624.695652173913,737.93548387096769,583.27999999999997,678.53125,628.78947368421052,570.85185185185185,591.68965517241384,604.14285714285711,561.5625,616.13793103448279,594.31428571428569,485.57999999999998,621.37209302325584,612.41935483870964,576.22727272727275,529.13793103448279,496.68627450980392,620.55555555555554,546.52112676056333,445.3692307692308,588.22340425531911,558.46511627906978,523.62162162162167,633.90909090909088,521.67499999999995,546.39534883720933,473.67073170731709,588.76666666666665,629.70588235294122,647.41176470588232,648.42702702702707,558.29090909090905,506.65873015873018,493.55284552845529,509.74820143884892,613.40559440559446,621.39007092198585,694.87234042553189,588.41358024691363,607.46198830409355,690.28571428571433,593.83941605839414,673.45121951219517,692.53731343283584,638.75091575091574,712.35106382978722,615.35714285714289,727.36986301369859,551.64444444444439,615.15999999999997,613.19375000000002,525.02459016393448,620.15189873417717,596.63846153846157,517.59748427672957,710.97014925373139,455.25,645.6908212560387,613.79999999999995,759.65454545454543,703.38461538461536,751.37142857142862,475.76315789473682,567.67857142857144,526.69230769230774,700.19500000000005,594.41935483870964,531.0140845070423,618.48214285714289,527.9655172413793,690.67256637168146,475.41311475409839,640.32608695652175,492.35294117647061,682.00523560209422,491.78947368421052,546.33076923076919,504.69565217391306,588.87647058823529,587.35433070866145,594.5272727272727,645.45714285714291,510.55345911949684,600.64285714285711,598.59124087591238,618.4341085271318],"mode":"markers","marker":{"color":"gray","size":2,"opacity":0.80000000000000004,"lines":{"color":"black","width":1},"showlegend":false,"line":{"color":"black","width":1}},"name":"Speakers","type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[495.6165178912504],"y":[481.88328640309874],"z":[596.96153969947113],"type":"scatter3d","mode":"markers","marker":{"color":"red","size":6,"opacity":1,"symbol":"x","line":{"color":"rgba(255,127,14,1)"}},"name":"Center","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[596.46069144656894,578.35966398476319,551.18271067723799,494.00050280679221,537.4054802343594,580.76653273787929,604.65672545951475,446.91221640367922,459.77616946253784,569.65839524822047,548.28926874434319,513.99090046392439,603.53974315802668,453.63135614478654,561.66274869746428,625.15752438812547,496.15970326426674,582.66283779932712,589.33837599445712,504.30334659285899,513.27809431592175,507.98554795548046,473.44182966753181,495.59210620478257,502.92637943123475,450.824216576092,532.6825849484228,543.84393662241007,512.78852302432085,458.15173128260949,409.63586787012582,533.85874101074921,467.55141773274164,391.74063312284636,486.15568074925397,488.72076853656893,457.78331990281151,537.72958370570518,466.8406156938608,466.69613400968882,394.50304713522291,519.57034224566189,526.66725755590687,525.32592607670767,508.02587494401757,433.85692413379854,412.24016937710223,421.87239368391073,447.03341852064068,507.09607159036352,513.49561504802364,572.82970089846287,490.57369314663958,496.54763053318663,580.85431403966402,475.76127140852077,548.27943835806855,580.39446800907081,503.01631078811778,584.40696728597356,501.78262412817338,577.94303571170531,453.80040888936685,498.2078282372716,534.18757491755525,431.13386466431751,514.03325097460106,488.13379236481109,441.53972739719592,557.95189061171322,391.86684440656819,508.91201545068958,487.78409122467525,547.95946422741781,527.28297815233293,540.42665649352637,403.89061614553805,465.87603465836804,434.3615599860488,514.56026900038557,452.30956067382755,433.41905342965418,470.0047436787284,436.6796219096446,544.08480864313617,411.53074201335556,484.93931822548353,423.6593726452802,507.04335234326288,398.86559654926333,418.54589743141548,423.87702157195588,482.1781735641826,475.33606441803909,458.27321564767129,512.85470754971425,400.02104828631775,459.52672021198356,450.21411849115293,458.16068334736423],"y":[606.45624127309929,584.0960156140211,550.52428550285799,479.88702060917041,533.50525261591736,587.06922409983883,616.58081405912753,421.71879164567088,437.60965164634251,573.34732563606735,546.95001245744754,504.58118802985194,615.20100419081086,430.0189547807779,563.47029177473632,641.90548091587812,482.55428408767688,589.41173251168971,597.65803459337349,492.61413858480955,503.70065755421189,497.16276730569916,454.49086165548238,481.85313061115318,490.91316903907381,426.55129117190364,527.67105317168284,541.45868719507155,503.09588942270648,435.60298079027854,375.67126386220923,529.12396047318305,447.21442718982826,353.56525424393385,470.19630046458207,473.36495715441538,435.14788167477047,533.90561810740519,446.33637239311321,446.15789395764841,356.97766830776936,511.47348061128611,520.24031045866832,518.58336172347606,497.21258329353429,405.59157003818382,378.88836131720979,390.78706207071991,421.86851279776215,496.06399585284112,503.9693612322539,577.26484413732123,475.65387763132549,483.03349120951901,587.17766047013311,457.35607142553727,546.93786896692575,586.6096119969626,491.02426137557092,591.56625821374496,489.50028644281326,583.58135409985107,430.22778588304982,485.08433585799844,529.53016947850347,402.22777069866214,504.63350367754128,472.639864632198,415.08214812975086,558.88626336191317,353.72116322703971,498.30723395558346,472.20787830306978,546.54260445602904,521.00091101065789,537.2373160611204,368.57414601621633,445.1448240312539,406.21494744346018,505.28452981447242,428.38613890509606,405.05066771786932,450.24502431384713,409.07845272307418,541.75623675405427,378.01200465869567,468.69372606254092,392.9945197914796,495.99887168990432,362.36673197018598,386.67783639185615,393.26338182846587,465.28288002994287,456.83081260920488,435.75305060386029,503.17764726358376,363.79406318844019,437.30150662282654,425.79763611656523,435.61403928894401],"z":[707.30664382686405,687.50024659371013,657.76284445278088,595.19327340822963,642.68760634819591,690.13387602236401,716.27485879363212,543.66861230838208,557.7445295351813,677.97919673109664,654.59679985034597,617.06704591541586,715.05264114812235,551.02078892146392,669.23024852612139,738.70711950556472,597.55590072631901,692.20883952382974,699.51330671591722,606.46678907404225,616.287083465916,610.49590526838142,572.6976859261398,596.93482809095428,604.96009236095858,547.94917757212011,637.51974831796895,649.73265531346317,615.75138771627655,555.96704657515318,502.88031075948203,638.80671471961523,566.25231486123528,483.29909479077276,586.60935947169389,589.41611437887661,555.56392569436946,643.0422448962928,565.47454533594635,565.31645145781351,486.32176681129812,623.17214909265431,630.93769301337159,629.46998936205057,610.54003162285869,529.38332904267816,505.72997386677895,516.26968832564296,543.80123335871212,609.52262779812838,616.52509769110554,681.44928369654565,591.44361038414957,597.98037616573879,690.22992754963013,575.23565149622243,654.58604330429228,689.72675759603294,605.05849650856294,694.11729038450426,603.70857932294132,687.0443661144302,551.20576879730686,599.79698769688321,639.16652937630647,526.40371931301797,617.11338643609952,588.77383684801475,537.78995975025009,665.16977574482019,483.43719694138139,611.50965895017862,588.39118897296828,654.23592313849645,631.61142309544459,645.99341963568452,496.59377602537609,564.4190872856866,529.93550864512611,617.69005692564747,549.5744618433996,528.90420479841396,568.93677839962538,532.47196439973254,649.99622084502869,504.95370853023468,585.27839859800019,518.22502568043433,609.46494166113359,491.09532935221296,512.62978963422665,518.46318017791828,582.25711551916265,574.7703840644391,556.09997646529939,615.82380774897342,492.35964079177779,557.47157867886028,547.28159972069773,555.97684204952407],"type":"scatter3d","mode":"lines","name":"PC1","line":{"color":"#D55E00","width":6},"marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[475.48728758105102,479.63998973381882,478.93884347448471,477.06148772106644,481.07808832087755,475.00616815469277,473.73733559362785,463.27784905142715,489.08638029638871,472.2830698071449,467.90102190017734,468.42974486654333,479.80087788332503,481.88193750847881,470.89681842158677,483.30624234957048,469.42730480223224,489.76352570255489,468.15375484305326,474.32336726454878,479.38735087333271,490.77621130985591,489.02022866592284,495.27885712138573,489.66957247601215,470.28907426721673,470.69451688914677,486.15046339605163,480.64229949381973,482.66051534158157,483.86639979161652,490.4692256051805,478.87906642412037,478.54122608691387,490.21541735832511,481.403258701619,481.88666501743467,486.65626893280199,479.91555069674041,477.50627860965966,479.38356219959138,485.10933399937653,490.34316979673849,495.86015997843697,507.12061661993295,503.02785129499892,490.33812152745338,468.47117591497533,472.43882589132562,500.27846551513699,503.44244687909008,512.61258160864827,496.82255165287506,493.28199823597288,502.65992636601334,500.6813660057025,509.13044409471559,510.83459382220138,490.85101182351639,509.82277804642189,497.55659688176331,511.56881836514265,497.29464087956774,507.72851071337919,494.28896771894688,490.70562222789266,499.4179103836355,500.78283454240051,490.53307522690932,527.08832825214245,492.3341629892077,516.15368237438736,508.33036081695701,548.26074089291569,531.97525679147884,548.42414711086997,494.66820578872773,502.32573094729173,500.51541249523933,539.80471849904984,522.6116124096211,498.14278840596847,520.24945352322254,499.89308181415345,532.8728576197833,494.70622932231345,527.64263730521498,489.00615632034015,535.23481142855019,501.14863748148019,510.44207839527473,496.99962239503344,509.54076096648333,511.81315592878548,516.41189945899293,522.1915851844592,506.72515497973876,522.58871027656437,515.8217954540753,521.95051294857365],"y":[528.1641568914564,518.61631688231364,520.22838345026366,524.54477593748652,515.3098588890623,529.27034056155117,532.18762425919476,556.23594277781353,496.89729576369587,535.53125367187852,545.60640252411179,544.3907693998683,518.2464048938441,513.46165905378621,538.71850523841317,510.18691546594505,542.09719227463654,495.34041165230076,545.0253221540662,530.84022768982743,519.19718093932431,493.01205777514463,497.04939075168124,482.65963175353113,495.55642771663008,540.11582287376291,539.18363435056347,503.64751858568985,516.31181902139372,511.67156279557622,508.8990085947475,493.71787540557136,520.36582208469997,521.14258029408245,494.30142810085937,514.56223128255033,513.45078962528123,502.48457692433999,517.98275061872141,523.52211837968844,519.20589180983666,506.04127006185672,494.00770131818234,481.32310761291018,455.43320882225532,464.84324283863475,494.01930823475954,544.29551165989858,535.17314126277711,471.16459567922755,463.89000994116799,442.80615272262185,479.11038890696074,487.25078432296107,465.68917115906299,470.23825199215122,450.81223903697611,446.8940796431429,492.84007738484468,449.22043361472026,477.422681446355,445.20595990594552,478.02496735716392,454.03554644888743,484.9355728862061,493.1743552952131,473.14317309999115,470.00495682223186,493.57107316681584,409.52370002544285,489.4300350754159,434.6644988491326,452.6517803402063,360.84435798139106,398.28773604025821,360.46865648194989,484.06363353625051,466.45754901819163,470.61981019415271,380.28633719402205,419.81650819187979,476.07491734434831,425.24755388064318,472.05066498633386,396.22398362425298,483.97621031110612,408.24923969584069,497.08174570978667,390.79340944737379,469.16390735402496,447.79654612389396,478.70327010714459,449.8688437005012,444.64418208512819,434.07080941012509,420.78222944946089,456.34244919910509,419.86916448511965,435.42756903805866,421.33649967020062],"z":[563.10929745190151,570.09308555960024,568.91393600165975,565.75670143430614,572.51160136943395,562.30017702751854,560.16632359314201,542.57612929582888,585.97951026443559,557.72061866862589,550.35112937364988,551.24030683664546,570.36365847907678,573.86347111357418,555.38929665597243,576.25878935336755,552.91794875732535,587.11829649585707,550.77616185995623,561.15187971143598,569.66821129592847,588.8213759465209,585.86826005838736,596.39368022333565,586.96029108105211,554.36722566660842,555.04907696661132,581.04204526466435,571.77871547588484,575.17284087131532,577.20083160400009,588.30510412285628,568.81340621693403,568.24524475423163,587.87826324893445,573.05845519002014,573.87142158042934,581.89268144381117,570.5565089656144,566.50472650422341,569.66183971095916,579.29113059956387,588.09311033579468,597.37128368024139,616.30850582792721,609.42551620999257,588.08462043170323,551.30998331540184,557.9825607603982,604.8017490804192,610.12276046281011,625.54459316699263,598.98978153624807,593.03547180296914,608.80676012081267,605.47932516247033,619.68852411494981,622.55447022972737,588.94717137285647,620.85285361429999,600.2242587877904,623.78924904186931,599.78371546308938,617.33082897665599,594.72893818733826,588.70266307643953,603.35451437099186,605.64996941621837,588.41248293609806,649.88911476758801,591.44145415352034,631.49982340170811,618.34298767269502,685.4957241925789,658.10768478794057,685.77053186230626,595.3667201000037,608.24472848332573,605.20023359506013,671.2748466867472,642.36041809915264,601.21008373862378,638.38786805042594,604.1536317802088,659.61722093080959,595.43066600604266,650.82132151645328,585.84459395470049,663.58942609115456,606.26515685844879,621.89435918159177,599.28756945789883,620.37857266262381,624.20016263703178,631.93407881862311,641.6540392084728,615.64343999892276,642.32190254022282,630.94167407100531,641.24861706353249],"type":"scatter3d","mode":"lines","name":"PC2","line":{"color":"#0072B2","width":4},"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The plot above can be rotated with the mouse and the legend on the right allows for different plot elements to be turned off. Double click ‘Speakers’ to see just the points for each speaker.</p>
<p>What are these elements?</p>
<ul>
<li>The points are the mean first formant values for <span class="smallcaps">dress</span>, <span class="smallcaps">trap</span>, and <span class="smallcaps">kit</span> for 100 speakers from the Origins of New Zealand English (ONZE) corpus.</li>
<li>The ‘Center’ is the centre of the cloud of points.</li>
<li>PC1 shows the first principal component derived from the data.</li>
<li>PC2 shows the second principal component.</li>
</ul>
<p>The idea here is to explain PCA in three dimensions as putting a cross in the centre of a cloud of points and then drawing the straight line which captures the most variation in the data. That is, to draw the straight line which is ‘inside’ the cloud of points for as much of its length as possible. We then create the second PC, by finding the line at right angles to the first line which captures the most possible variance.</p>
<p>The data can then be plotted against these two lines rather than the original three dimensions and the same idea extends to cases when we have many many more variables than three.</p>
<p>Ideally, the principal components are <em>interpretable</em>. In this case, the first PC is a line from small values of all three variables to large values. That is, we can interpret it as capturing something like vocal tract length. Speakers with long vocal tracts tend to have lower first formant values.</p>
<p>The second formant is also interpretable. The ONZE corpus contains speakers born in the mid-nineteenth century all the way through to the 1980’s. In this time, <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> have raised, while <span class="smallcaps">kit</span> has lowered. The line for PC2 (the blue line), runs from high values of <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> and low values of <span class="smallcaps">kit</span> to low values of <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> and high values of <span class="smallcaps">kit</span>. That is, it captures the structure in our data which comes from the structured change in vowel spaces which has occurred over time in New Zealand English.</p>
</section>
<section id="lessons-learned" class="level2">
<h2 class="anchored" data-anchor-id="lessons-learned">Lessons Learned</h2>
<p>I have not found the <code>plotly</code> documentation for R to be very easy to get my head into.</p>
<p>A few things which caused me trouble and might help you:</p>
<ul>
<li><code>plotly</code> is not ‘surly’. Surliness is a feature of the <code>tidyverse</code> packages: they complain. If you add an argument to a <code>plotly</code> function which it doesn’t recognise, it will often just ignore it without telling you. This is not great for people who like to use ‘colour’ rather than ‘color’ or ‘grey’ rather than ‘gray’.</li>
<li>Often an initial plot is made with <code>plot_ly()</code> and then additional features are added to the plot with <code>add_trace()</code>. In this case, the points are added to the plot at the <code>plot_ly()</code> stage, and the lines and the red cross added using <code>add_trace()</code>. The first argument to <code>plot_ly()</code> is a data frame, but this is not the case for <code>add_trace()</code>. I have found being explicit by saying <code>data = onze_to_pca</code> rather than just having <code>plot_ly(onze_to_pca ...)</code>, avoids confusion. It took me a long time to work out why my <code>add_trace(onze_to_pca)</code> was not functioning.</li>
<li>If the added element is different in <code>type</code> from the original plot, it is vital to add <code>inherit = FALSE</code> to any <code>add_trace()</code> calls. My initial attempts to add lines to the plot added both lines <em>and</em> points (‘markers’ in <code>plotly</code> speak) because I failed to add <code>inherit = FALSE</code>.</li>
<li>Axis labelling for 3D plots occurs by modifying the <code>scene</code> rather than <code>xaxis</code> or <code>yaxis</code> etc. directly. See the call to <code>layout()</code> in the plot code.</li>
</ul>
<p>It may be that there are obvious solutions to some of these problems. If so, please let me know!</p>


</section>

 ]]></description>
  <category>data science</category>
  <category>vowels</category>
  <category>pca</category>
  <category>plotly</category>
  <guid>https://joshua.wilsonblack.nz/posts/plotly-struggles/</guid>
  <pubDate>Mon, 18 Jul 2022 12:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/plotly-struggles/feature.png" medium="image" type="image/png" height="81" width="144"/>
</item>
<item>
  <title>Visualising Vowel Space Change with GAMs</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/</link>
  <description><![CDATA[ 




<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Multiple recent projects at <a href="https://www.canterbury.ac.nz/nzilbb/">NZILBB</a> have used <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">Generalised Mixed Models (GAMMs)</a> to investigate changes in vowel spaces both across multiples speakers and within single speakers.</p>
<p>In such projects, it is useful to visualise changes to vowel spaces over time with both static plots and animations.</p>
<p>This post sets out a structure for fitting models of the first and second formants of a series of vowels and for visualising them together within vowel space diagrams.</p>
<p>This general structure, and some specific code for visualisation, was originally developed by James Brand for <a href="https://www.sciencedirect.com/science/article/pii/S0095447021000711">Brand et al. 2021</a>.</p>
<p>I’ll assume the reader knows something about vowels and vowel spaces, the basics of data manipulation with <code>dplyr</code>, and setting up models in R.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/feature.jpg" class="img-fluid figure-img"></p>
<figcaption>The New Zealand Broadcasting Service Mobile Unit (<a href="https://ngataonga.org.nz/blog/sound/preserving-the-mobile-unit-collection/">source</a>)</figcaption>
</figure>
</div>
</section>
<section id="fitting-multiple-models-with-purrr-and-mgcv" class="level2">
<h2 class="anchored" data-anchor-id="fitting-multiple-models-with-purrr-and-mgcv">Fitting Multiple Models with <code>purrr</code> and <code>mgcv</code></h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>We’re going to fit these models with a small subset of the data from the <a href="https://www.canterbury.ac.nz/nzilbb/research/onze/">Origins of New Zealand English (ONZE)</a> corpus. This dataset contains first and second formant data for 100 speakers of New Zealand English (for details see <a href="https://osf.io/q4j29/">supplementaries for Brand et al.&nbsp;2021</a>). The data can be found <a href="anon_ONZE_mean_sample.rds">here</a>.</p>
<p>For the purposes of this post any similar data set would be fine. We need:</p>
<ul>
<li>first and second formant data,</li>
<li>a range of vowels (we’ll only look at monophthongs here),</li>
<li>a time variables (whether year of birth, age category, or time through recording), and</li>
<li>any variables you wish to control for.</li>
</ul>
<p>Let’s load the libraries we will use and have a look at the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load tidyverse and friends.</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gganimate)</span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mgcv will be used for fitting gamms later and itsadug for visualisation</span></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mgcv)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(itsadug)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># kable for displaying the dataset.</span></span>
<span id="cb1-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(kableExtra)</span>
<span id="cb1-11"></span>
<span id="cb1-12">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_rds</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'anon_ONZE_mean_sample.rds'</span>)</span>
<span id="cb1-13"></span>
<span id="cb1-14">vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scroll_box</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Speaker</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Vowel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F1_50</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F2_50</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Speech_rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yob</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">DRESS</td>
<td style="text-align: right;">622.5797</td>
<td style="text-align: right;">1897.986</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">FLEECE</td>
<td style="text-align: right;">518.7458</td>
<td style="text-align: right;">1882.763</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">GOOSE</td>
<td style="text-align: right;">524.0606</td>
<td style="text-align: right;">1944.152</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">KIT</td>
<td style="text-align: right;">646.8214</td>
<td style="text-align: right;">1790.054</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">LOT</td>
<td style="text-align: right;">735.3438</td>
<td style="text-align: right;">1262.969</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">NURSE</td>
<td style="text-align: right;">534.8571</td>
<td style="text-align: right;">1912.714</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">START</td>
<td style="text-align: right;">888.3929</td>
<td style="text-align: right;">1604.750</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">STRUT</td>
<td style="text-align: right;">831.9661</td>
<td style="text-align: right;">1511.373</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">THOUGHT</td>
<td style="text-align: right;">594.5000</td>
<td style="text-align: right;">1051.571</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">TRAP</td>
<td style="text-align: right;">637.8667</td>
<td style="text-align: right;">1816.833</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>In this dataset each row is a vowel token, with columns:</p>
<ul>
<li><code>F1_50</code> and <code>F2_50</code>: F1 and F2, taken at the midpoint measured in Hz,</li>
<li><code>Vowel</code>: Wells lexical set labels for New Zealand English monophthongs,</li>
<li><code>yob</code>: participant year of birth (our time variable),</li>
<li><code>Speech_rate</code>: the average speech rate of the participant across the recording (a control variable),</li>
<li><code>Speaker</code>: a code indicating which speaker the token comes from (sometimes useful as a random effect), and</li>
<li><code>Gender</code>: the gender of the speaker (in this case, an <code>M</code>/<code>F</code> binary).</li>
</ul>
<p>In any real research project, you will need to engage in a lot of data exploration here. Do you have good data coverage? Is there evidence of outliers in the data? Does the data need to be normalised? This is the time to ask this kind of question. The answers will, of course, depend on your research questions. For this post, the only point of this data is to illustrate a method for modelling and visualising. We can skip these questions!</p>
<p>We will now fit separate models for the F1 and F2 of each vowel. Rather than using a big <code>for</code> loop, or fitting each model with a separate line of code, we will use the <code>purrr</code> method of <em>nesting</em> our data so that we have a row for each of the models we want to fit, fit the models, and then <em>unnest</em> to produce data which can be used to visualise our model. <strong>We nest, we mutate, and we unnest.</strong> This is a common pattern with <code>purrr</code>.</p>
<p>Before we nest, we need to slightly modify our data. Rather than having a column for our F1 data and a column for our F2 data, we want to capture there in <em>rows</em>. That is, we need our table to be <em>longer</em>. There will then be two rows for each token, one for the F1 and one for the F2.</p>
<p>To do this, we use the trusty <code>dplyr</code> function <code>pivot_longer()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb2-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> F1_50<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>F2_50, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Select the columns to turn into rows.</span></span>
<span id="cb2-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Formant"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Name the column to indicate if data is F1 or F2,</span></span>
<span id="cb2-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Frequency"</span></span>
<span id="cb2-6">  )</span>
<span id="cb2-7"></span>
<span id="cb2-8">vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scroll_box</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Speaker</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Vowel</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Speech_rate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yob</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Formant</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">DRESS</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: right;">622.5797</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">DRESS</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F2_50</td>
<td style="text-align: right;">1897.9855</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">FLEECE</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: right;">518.7458</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">FLEECE</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F2_50</td>
<td style="text-align: right;">1882.7627</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">GOOSE</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: right;">524.0606</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">GOOSE</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F2_50</td>
<td style="text-align: right;">1944.1515</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">KIT</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: right;">646.8214</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">KIT</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F2_50</td>
<td style="text-align: right;">1790.0536</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">LOT</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: right;">735.3438</td>
</tr>
<tr class="even">
<td style="text-align: left;">CC_f_020</td>
<td style="text-align: left;">LOT</td>
<td style="text-align: right;">4.9264</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1936</td>
<td style="text-align: left;">F2_50</td>
<td style="text-align: right;">1262.9688</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>As the table above shows, we now have a column indicating whether a frequency value is an F1 or an F2 reading.</p>
</section>
<section id="nest" class="level3">
<h3 class="anchored" data-anchor-id="nest">Nest</h3>
<p>We now nest the data. We do this by grouping the data by the columns which identify the models we want to fit. In this case, we fit an F1 and an F2 model for each vowel. So the columns we need to identify our models are <code>Vowel</code> and <code>Formant</code>. Once we’ve grouped, we simply use the function <code>nest()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Vowel, Formant) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="cb3-4">  </span>
<span id="cb3-5">vowels</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
# Groups:   Vowel, Formant [20]
   Vowel   Formant data              
   &lt;fct&gt;   &lt;chr&gt;   &lt;list&gt;            
 1 DRESS   F1_50   &lt;tibble [100 × 5]&gt;
 2 DRESS   F2_50   &lt;tibble [100 × 5]&gt;
 3 FLEECE  F1_50   &lt;tibble [100 × 5]&gt;
 4 FLEECE  F2_50   &lt;tibble [100 × 5]&gt;
 5 GOOSE   F1_50   &lt;tibble [100 × 5]&gt;
 6 GOOSE   F2_50   &lt;tibble [100 × 5]&gt;
 7 KIT     F1_50   &lt;tibble [100 × 5]&gt;
 8 KIT     F2_50   &lt;tibble [100 × 5]&gt;
 9 LOT     F1_50   &lt;tibble [100 × 5]&gt;
10 LOT     F2_50   &lt;tibble [100 × 5]&gt;
11 NURSE   F1_50   &lt;tibble [100 × 5]&gt;
12 NURSE   F2_50   &lt;tibble [100 × 5]&gt;
13 START   F1_50   &lt;tibble [100 × 5]&gt;
14 START   F2_50   &lt;tibble [100 × 5]&gt;
15 STRUT   F1_50   &lt;tibble [100 × 5]&gt;
16 STRUT   F2_50   &lt;tibble [100 × 5]&gt;
17 THOUGHT F1_50   &lt;tibble [100 × 5]&gt;
18 THOUGHT F2_50   &lt;tibble [100 × 5]&gt;
19 TRAP    F1_50   &lt;tibble [100 × 5]&gt;
20 TRAP    F2_50   &lt;tibble [100 × 5]&gt;</code></pre>
</div>
</div>
<p>The output above shows that we now have a three column data frame (or, in tidyverse speak, a tibble), with the familiar columns <code>Vowel</code> and <code>Formant</code> and a new column <code>data</code>. The column <code>data</code> contains tibbles which live <em>inside</em> our tibble. That is, <em>nested</em> tibbles. These contain the data which we will use to model each vowel and formant separately.</p>
</section>
<section id="mutate-and-map" class="level3">
<h3 class="anchored" data-anchor-id="mutate-and-map">Mutate (and Map)</h3>
<p>We can perform actions on the tibbles in the <code>data</code> column by using <code>mutate</code> (just as we would modify other data in a tibble). In this case we will create a column to store our models. The basic structure will look something like this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#???</span></span>
<span id="cb5-4">  )</span></code></pre></div>
</div>
<p>The question marks can be filled in with the <code>map()</code> function. This enables us to apply a function to fit a model to each of our nested tibbles.</p>
<p>So, what will this function look like? This is not the place for a tutorial on GAMs (for which, go <a href="https://arxiv.org/abs/1703.05339">here</a>). We will fit a model which predicts formant frequency from the gender of each participant, their year of birth, and their average speech rate. One way to implement this structure in <code>mgcv</code> is with the formula <code>Frequency ~ Gender + s(yob, by=Gender) + s(Speech_rate)</code>.</p>
<p>This structure will be the same for <em>all</em> of our nested tibbles. The only thing that will change is the data fed in to it. In this kind of case, we can use <code>~</code> to turn our model expression into a function and <code>.x</code> as a pronoun for the nested tibbles. Let’s see what this look like and then explain further:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb6-4">      data, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We are applying a function to the entries of the `data` column.</span></span>
<span id="cb6-5">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This is the function we are applying (introduced with a ~)</span></span>
<span id="cb6-6">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bam</span>( </span>
<span id="cb6-7">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here's our formula.</span></span>
<span id="cb6-8">          Frequency <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-9">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(yob, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span>Gender, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-10">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">s</span>(Speech_rate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">k=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb6-11">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .x, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Here's our pronoun.</span></span>
<span id="cb6-12">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Then some arguments to speed up the model fit.</span></span>
<span id="cb6-13">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fREML'</span>,</span>
<span id="cb6-14">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">discrete =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-15">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nthreads =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-16">      )</span>
<span id="cb6-17">    )</span>
<span id="cb6-18">  )</span></code></pre></div>
</div>
<p>The function <code>bam</code> is one of the main functions for fitting GAMM models in <code>mgcv</code>. It is often used for large data sets. Our use of <code>~</code> creates a function which is applied to each of our nested tibbles. The entries in <code>model</code> are created by taking the corresponding tibble in the <code>data</code> column and applying the function to it. The tibble is referred to by the pronoun <code>.x</code> in the function. In the above, <code>.x</code> is used as the data fed to <code>bam()</code>. So, for the row of our tibble with <code>DRESS</code> and <code>F1_50</code> in the <code>Vowel</code> and <code>Formant</code> columns, the entry for <code>model</code> will be a model produced from the data for <span class="smallcaps">dress</span> and F1.</p>
<p>Note that you can use any modelling function you like here. The general strategy of nesting and fitting models doesn’t have any special connections with GAMs or <code>mgcv</code>. You could fit a linear model with <code>lm</code> or a generalised linear model using the <code>lme4</code> package.</p>
<p>We now have GAMM models for each of these vowels. These are stored in the <code>model</code> column we have just created. We can check out one of these models using the <code>itsadug</code> <code>plot_smooth()</code> function as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot_smooth</span>(</span>
<span id="cb7-2">  vowels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]], <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pick the first entry in the model column.</span></span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">view =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The x-axis variable.  </span></span>
<span id="cb7-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot_all =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span>,</span>
<span id="cb7-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(vowels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Vowel[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]], vowels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Formant[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>]])</span>
<span id="cb7-6">)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Summary:
    * Gender : factor; set to the value(s): F, M. 
    * yob : numeric predictor; with 30 values ranging from 1864.000000 to 1981.000000. 
    * Speech_rate : numeric predictor; set to the value(s): 4.5118. 
    * NOTE : No random effects in the model to cancel.
 </code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/smooth-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Smooth plot for KIT F1</figcaption>
</figure>
</div>
</div>
</div>
<p>Figure 1 shows a well known feature of the development of New Zealand English: the centralisation of the <span class="smallcaps">kit</span> vowel. It also indicates something to keep in mind when fitting non-linear models. The wiggles in the smooth for the female speakers might simply be over fitting our particular sample. Again, this is illustrative of a general pattern, each step of which requires criticism in practice!</p>
<p>For the purpose of visualisation, we want predictions from our model to plot. To do this, we map again. This time, we use the <code>itsadug</code> function <code>get_predictions()</code> instead of the <code>mgcv</code> function <code>bam()</code>, but the underlying idea is the same. The function <code>get_predictions()</code> needs us to tell it what values we want predictions for. In this case, we want predictions for the full range of years of birth in our data set (1864-1981) <em>and</em> for both genders.</p>
<p>The following code stores the values we want predictions for in the <code>to_predict</code> object and then creates a <code>prediction</code> column using <code>mutate()</code> and <code>map()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">to_predict <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb9-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yob"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1864</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">to=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1981</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># All years</span></span>
<span id="cb9-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Gender"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>)</span>
<span id="cb9-4">) </span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BTW: Get prediction will just assume the average value for any predictors not</span></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># mentioned (in this case, Speech_rate).</span></span>
<span id="cb9-7"></span>
<span id="cb9-8">vowels <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prediction =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb9-11">      model, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This time we're applying the function to all the models.</span></span>
<span id="cb9-12">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># We again introduce the function with '~', and indicate where the model </span></span>
<span id="cb9-13">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># goes with '.x'.</span></span>
<span id="cb9-14">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get_predictions</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cond =</span> to_predict, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">print.summary =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb9-15">    )</span>
<span id="cb9-16">  )</span></code></pre></div>
</div>
<p>So what does a tibble of predictions look like?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">vowels<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>prediction[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scroll_box</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yob</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Speech_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fit</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">M</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">501.5480</td>
<td style="text-align: right;">27.00804</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">570.1079</td>
<td style="text-align: right;">36.38487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">M</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">501.0873</td>
<td style="text-align: right;">26.68430</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">569.3392</td>
<td style="text-align: right;">35.95156</td>
</tr>
<tr class="odd">
<td style="text-align: left;">M</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">500.6266</td>
<td style="text-align: right;">26.36302</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">568.5705</td>
<td style="text-align: right;">35.51985</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>As expected, we get a predicted value for each gender in each of the years spanned by the data.</p>
</section>
<section id="unnest" class="level3">
<h3 class="anchored" data-anchor-id="unnest">Unnest</h3>
<p>In order to visualise the predictions of our models, we need to <em>unnest</em> this data set. We will do this in a slightly non-standard way, by making a new unnested tibble at this stage rather than modifying our original tibble again. But the same principles apply.</p>
<p>In this case, we need to select our identifying variables (<code>Vowel</code> and <code>Formant</code>) and the column with the data we want access to in a non-nested form (for us, <code>prediction</code>). We unnest as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> vowels <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb11-3">    Vowel, Formant, prediction</span>
<span id="cb11-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(prediction)</span>
<span id="cb11-6"></span>
<span id="cb11-7">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scroll_box</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Vowel</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Formant</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yob</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Speech_rate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fit</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">CI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">501.5480</td>
<td style="text-align: right;">27.00804</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">570.1079</td>
<td style="text-align: right;">36.38487</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">501.0873</td>
<td style="text-align: right;">26.68430</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">569.3392</td>
<td style="text-align: right;">35.95156</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">500.6266</td>
<td style="text-align: right;">26.36302</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F1_50</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">4.4873</td>
<td style="text-align: right;">568.5705</td>
<td style="text-align: right;">35.51985</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<p>Our tibble now has our predicted values along with the <code>Vowel</code> and <code>Formant</code> information which identifies which model they came from.</p>
<p>Note that we have now thrown away our individual speaker information. This is often the case when visualising models of this sort as we are not interested in predicting the speech of this or that particular speaker in our data set. Rather, we want to say something about NZE speech <em>in general</em>.</p>
<p>We are now in a position to <em>visualise</em> changes in the overall NZE vowel space.</p>
</section>
</section>
<section id="visualise-model-predictions-as-a-vowel-space" class="level2">
<h2 class="anchored" data-anchor-id="visualise-model-predictions-as-a-vowel-space">Visualise Model Predictions as a Vowel Space</h2>
<p>We first produce a static plot using a standard <code>ggplot</code> approach and then produce an animation using <code>gganimate</code>.</p>
<p>We begin by defining a colour scheme (following Brand et al.&nbsp;2021, again). These use html colour codes (plenty of explanations are available online).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">vowel_colours <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb12-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">DRESS =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9590FF"</span>,</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FLEECE =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D89000"</span>,</span>
<span id="cb12-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GOOSE =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#A3A500"</span>,</span>
<span id="cb12-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">KIT =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#39B600"</span>,</span>
<span id="cb12-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">LOT =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00BF7D"</span>,</span>
<span id="cb12-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NURSE =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00BFC4"</span>,</span>
<span id="cb12-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">START =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#00B0F6"</span>,</span>
<span id="cb12-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">STRUT =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#F8766D"</span>,</span>
<span id="cb12-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">THOUGHT =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E76BF3"</span>,</span>
<span id="cb12-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">TRAP =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FF62BC"</span></span>
<span id="cb12-12">)</span></code></pre></div>
</div>
<p>We also need to reverse our previous use of <code>pivot_longer()</code>. Why? Well vowel spaces have F1 as the <em>y</em>-axis and F2 as the <em>x</em>-axis. This requires F1 and F2 to be distinct columns. To do this, we use <code>pivot_wider()</code>. This is made easier if we remove the columns we will not use for plotting first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">predictions <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove unneeded variables</span></span>
<span id="cb13-3">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>Speech_rate,</span>
<span id="cb13-4">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>CI</span>
<span id="cb13-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>( <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pivot</span></span>
<span id="cb13-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> Formant,</span>
<span id="cb13-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> fit</span>
<span id="cb13-9">  )</span>
<span id="cb13-10"></span>
<span id="cb13-11">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scroll_box</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"100%"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Vowel</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Gender</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yob</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F1_50</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F2_50</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">501.5480</td>
<td style="text-align: right;">1657.465</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1864</td>
<td style="text-align: right;">570.1079</td>
<td style="text-align: right;">1964.213</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">501.0873</td>
<td style="text-align: right;">1659.390</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1865</td>
<td style="text-align: right;">569.3392</td>
<td style="text-align: right;">1966.005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">M</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">500.6266</td>
<td style="text-align: right;">1661.316</td>
</tr>
<tr class="even">
<td style="text-align: left;">DRESS</td>
<td style="text-align: left;">F</td>
<td style="text-align: right;">1866</td>
<td style="text-align: right;">568.5705</td>
<td style="text-align: right;">1967.797</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
<section id="static-plot" class="level3">
<h3 class="anchored" data-anchor-id="static-plot">Static Plot</h3>
<p>The plot we eventually produce is quite complex. Let’s start with depicting the data in two-dimensions using points and only plotting the female speakers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb14-3">    Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span></span>
<span id="cb14-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb14-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb14-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb14-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb14-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb14-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel</span>
<span id="cb14-10">    )</span>
<span id="cb14-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is the wrong way around for a vowel plot. So we reverse the <em>x</em> and <em>y</em> axes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb15-3">    Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span></span>
<span id="cb15-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb15-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb15-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb15-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb15-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb15-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel</span>
<span id="cb15-10">    )</span>
<span id="cb15-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb15-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It’s also unclear which direction these changes are occurring. We need to swap out <code>geom_point()</code> for something directed. In this case, we use <code>geom_path()</code> and <code>arrow()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb16-3">    Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span></span>
<span id="cb16-4">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb16-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb16-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb16-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb16-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel</span>
<span id="cb16-10">    )</span>
<span id="cb16-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can add labels to the start of each arrow and remove the legend. This is found by some to be a more clear vowel plot. To do this, we have to pick out the first observation of each vowel in a new tibble. This prevents us from labelling <em>every</em> point on the line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">first_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Vowel, Gender) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which.min</span>(yob))</span>
<span id="cb17-4"></span>
<span id="cb17-5">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb17-7">    Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span></span>
<span id="cb17-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb17-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb17-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb17-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb17-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb17-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel,</span>
<span id="cb17-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> Vowel <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add label to the aesthetics.</span></span>
<span id="cb17-15">    )</span>
<span id="cb17-16">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(</span>
<span id="cb17-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)),</span>
<span id="cb17-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove legend</span></span>
<span id="cb17-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb17-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Note filtering as we are only dealing with female speakers now.</span></span>
<span id="cb17-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> first_obs <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(Gender <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"F"</span>), </span>
<span id="cb17-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Again remove legend.</span></span>
<span id="cb17-25">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb17-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Often need to use 'expansion' here to fit in 'THOUGHT'</span></span>
<span id="cb17-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb17-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can use the faceting functions to plot both male and female data. We use the <code>facet_grid()</code> function. <strong>NB</strong>: this requires us to remove the <code>filter()</code> functions from the above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb18-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb18-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb18-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb18-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel,</span>
<span id="cb18-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> Vowel</span>
<span id="cb18-8">    )</span>
<span id="cb18-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(</span>
<span id="cb18-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)),</span>
<span id="cb18-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb18-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb18-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> first_obs, </span>
<span id="cb18-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb18-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb18-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb18-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb18-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Gender)</span>
<span id="cb18-22">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are still a few shortcomings here. We have overlap of the labels, which are now a little large. We attempt to fix this, while also adding a call to <code>labs()</code> to properly label the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb19-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb19-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb19-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb19-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel,</span>
<span id="cb19-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> Vowel</span>
<span id="cb19-8">    )</span>
<span id="cb19-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(</span>
<span id="cb19-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">arrow =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mm"</span>)), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make arrows smaller</span></span>
<span id="cb19-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb19-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>(</span>
<span id="cb19-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> first_obs, </span>
<span id="cb19-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb19-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make labels smaller...</span></span>
<span id="cb19-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ...and slightly transparent.</span></span>
<span id="cb19-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># less expanasion needed.</span></span>
<span id="cb19-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb19-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Gender)</span>
<span id="cb19-24">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb19-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb19-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb19-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Hz)"</span>,</span>
<span id="cb19-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Hz)"</span></span>
<span id="cb19-29">  )</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This figure is a good starting point for the kind of smaller adjustments needed to produce a good vowel space visualisation. In your own cases, a lot will depend on the specifics of the models and how much change is being depicted. In this case, it would be nice to make some of these lines a little less messy. Some of the problems here, for instance, the messy lines for <span class="smallcaps">start</span> and <span style="font-variant:
small-caps;">strut</span> in the male speakers, suggest that our models might be behaving a strangely. This is not a problem for this illustration, but some model criticism would be required in a real research project!</p>
</section>
<section id="animation" class="level3">
<h3 class="anchored" data-anchor-id="animation">Animation</h3>
<p>One problem with the static plot is that we can’t see variation in the rate of change (if any exists). Nor can we figure out, for any point on the line (apart from the start and end) which year it represents. This can be fixed with the <a href="https://gganimate.com/articles/gganimate.html"><code>gganimate</code></a> package.</p>
<p>We use the <code>gganimate</code> function <code>transition_reveal()</code> at the end of our plot with <code>yob</code> as the variable we animate with. Our <code>geom_label()</code>, the text with the vowel name, will be the main item we animate. The labels will move around the vowel space over time. We change our <code>geom_path()</code> so that it has no arrows and simply traces where the label of the vowel moves.</p>
<p>We add a caption to our <code>labs()</code> in which we reference the <code>gganimate</code> variable <code>frames_along</code>. This allows us to show what year it is. Finally, a call to <code>theme()</code> lets us make this caption larger.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">predictions <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb20-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb20-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb20-4">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> F2_50,</span>
<span id="cb20-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> F1_50,</span>
<span id="cb20-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> Vowel,</span>
<span id="cb20-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> Vowel</span>
<span id="cb20-8">    )</span>
<span id="cb20-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_path</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># NB: our labels just use the predictions dataframe now, so no need for the</span></span>
<span id="cb20-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 'data = ' line.</span></span>
<span id="cb20-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_label</span>( </span>
<span id="cb20-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">show.legend =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>,</span>
<span id="cb20-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.5</span>, </span>
<span id="cb20-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span> </span>
<span id="cb20-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_reverse</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">expand =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expansion</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_reverse</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_grid</span>(</span>
<span id="cb20-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(Gender)</span>
<span id="cb20-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb20-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Vowel Space Change in NZE (yob: 1864-1981)"</span>,</span>
<span id="cb20-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"First Formant (Hz)"</span>,</span>
<span id="cb20-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Second Formant (Hz)"</span>,</span>
<span id="cb20-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'Year of Birth: {round(frame_along, 0)}'</span> </span>
<span id="cb20-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb20-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb20-31">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb20-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transition_reveal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">along =</span> yob)</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?
`geom_path()`: Each group consists of only one observation.
ℹ Do you need to adjust the group aesthetic?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/index_files/figure-html/unnamed-chunk-17-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>So there is it: a general structure for fitting models to visualise changes in vowel formants over time, and for plotting them within vowel space diagrams.</p>
<p>As I’ve noted multiple times above, the details will matter at every step in a real research project. Data quality assessment before modelling, sensible model structures, evaluation of model quality, and careful consideration of exactly what needs to be visualised are all necessary.</p>
<p>This is, however, plenty for a blog post!</p>


</section>
</section>

 ]]></description>
  <category>GAMMs</category>
  <category>vowels</category>
  <category>sociolinguistics</category>
  <guid>https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/</guid>
  <pubDate>Tue, 28 Jun 2022 12:00:00 GMT</pubDate>
  <media:content url="https://joshua.wilsonblack.nz/posts/visualising-vowel-space-gamms/feature.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Peirce on Metaphysics and Common Sense Belief</title>
  <dc:creator>Joshua Wilson Black</dc:creator>
  <link>https://joshua.wilsonblack.nz/posts/contribution-to-pragmatic-reason/</link>
  <description><![CDATA[ 




<p>A volume in honour of Christopher Hookway is currently in the works edited by Robert Talisse, Paniel Reyes Cárdenas, and Daniel Herbert. I’ve contributed a piece on Chris’s account of Peirce’s metaphysics, especially as it appeals to ‘common sense’.</p>
<p>On Chris’s view, metaphysics articulates those features of common sense or instinct which are appealed to (often implicitly) in the generation of scientific hypotheses. Importantly, Chris takes it that the role of common sense diminishes as sciences develop. We might, then, expect the need for metaphysics to reduce over time (perhaps being replaced by… physics).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://joshua.wilsonblack.nz/posts/contribution-to-pragmatic-reason/feature.jpg" class="img-fluid figure-img"></p>
<figcaption>Chris and former students at <em>The Idea of Pragmatism</em>, a conference in his honour (I’m second from right).</figcaption>
</figure>
</div>
<p>I argue that Chris’s emphasis on Peirce’s appeals to common sense <em>belief</em> hides Peirce’s more fundamental appeal to common <em>experience</em>. I emphasise Peirce’s notion of the ‘scientific intelligence’, or anything which can learn from experience (CP2.229, c.&nbsp;1897). By abstraction, we make fallible claims about features of experience <em>common</em> to any scientific intelligence. This is the source of the strong modal claims which Peirce makes in his logic and metaphysics. I argue that common sense beliefs are only interesting for Peirce insofar as they give us access to common experience.</p>
<p>Download a pre-print of the paper <a href="PragmaticReason_WilsonBlack.pdf">here</a>.</p>



 ]]></description>
  <category>philosophy</category>
  <category>Peirce</category>
  <guid>https://joshua.wilsonblack.nz/posts/contribution-to-pragmatic-reason/</guid>
  <pubDate>Mon, 27 Jun 2022 12:00:00 GMT</pubDate>
</item>
</channel>
</rss>
