<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joshua Wilson Black">
<meta name="dcterms.date" content="2022-07-19">
<meta name="description" content="Attempts to produce an illustrative example of PCA using formant data and Plotly via R.">

<title>Joshua Wilson Black - A 3D PCA Visualisation with Plotly</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="../../site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="../../site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="../../site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Joshua Wilson Black - A 3D PCA Visualisation with Plotly">
<meta property="og:description" content="Attempts to produce an illustrative example of PCA using formant data and Plotly via R.">
<meta property="og:image" content="https://joshua.wilsonblack.nz/posts/plotly-struggles/feature.png">
<meta property="og:site_name" content="Joshua Wilson Black">
<meta property="og:image:height" content="721">
<meta property="og:image:width" content="1282">
<meta name="twitter:title" content="Joshua Wilson Black - A 3D PCA Visualisation with Plotly">
<meta name="twitter:description" content="Attempts to produce an illustrative example of PCA using formant data and Plotly via R.">
<meta name="twitter:image" content="https://joshua.wilsonblack.nz/posts/plotly-struggles/feature.png">
<meta name="twitter:image-height" content="721">
<meta name="twitter:image-width" content="1282">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joshua Wilson Black</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link active" data-scroll-target="#the-problem">The Problem</a></li>
  <li><a href="#a-plotly-example" id="toc-a-plotly-example" class="nav-link" data-scroll-target="#a-plotly-example">A Plotly Example</a></li>
  <li><a href="#lessons-learned" id="toc-lessons-learned" class="nav-link" data-scroll-target="#lessons-learned">Lessons Learned</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/JoshuaWilsonBlack/quarto-personal/edit/main/posts/plotly-struggles/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JoshuaWilsonBlack/quarto-personal/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A 3D PCA Visualisation with Plotly</h1>
  <div class="quarto-categories">
    <div class="quarto-category">data science</div>
    <div class="quarto-category">vowels</div>
    <div class="quarto-category">pca</div>
    <div class="quarto-category">plotly</div>
  </div>
  </div>

<div>
  <div class="description">
    Attempts to produce an illustrative example of PCA using formant data and Plotly via R.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joshua Wilson Black </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 19, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>I am attempting to build a nice illustrative example of PCA which shows how it can produce interpretable, lower-dimensional representations of vowel formant data.</p>
<p>One <a href="https://towardsdatascience.com/pca-principal-component-analysis-explained-visually-in-5-minutes-20ce8a9ebf0f">well</a>-<a href="https://towardsdatascience.com/principal-component-analysis-pca-explained-visually-with-zero-math-1cbf392b9e7d">trodden</a> <a href="https://machinelearningmastery.com/principal-component-analysis-for-visualization/">method</a> of showing how PCA works is to start with three dimensions and go down to two dimensions.</p>
<p>Heavy use of <code>ggplot2</code> for the last year and a half has worn deep grooves into my brain. But <code>ggplot2</code> does not offer options for 3D plots.</p>
<p>A few extension packages exist to extend <code>ggplot</code> into three dimensions, but nothing stood out to me as I was looking around. I have also wanted to explore <code>plotly</code> a little more after playing around with <code>plotly</code> cytoscapes for <a href="https://nz-newspaper-philosophy.herokuapp.com/">another project</a>.</p>
<p>The following example, which will be used for a larger project on PCA in the study of vowel covariation, took far more work than anticipated. I’ll present it in the next section and then run through some of the problems which occurred for me.</p>
</section>
<section id="a-plotly-example" class="level2">
<h2 class="anchored" data-anchor-id="a-plotly-example">A Plotly Example</h2>
<p>Here’s the code, with the Plotly interactive following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganising data</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'onze_means.rda'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>onze_sub <span class="ot">&lt;-</span> onze_means <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    vowel <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"DRESS"</span>, <span class="st">"KIT"</span>, <span class="st">"TRAP"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    speaker, vowel, F1_50, yob, gender</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>onze_to_pca <span class="ot">&lt;-</span> onze_sub <span class="sc">%&gt;%</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> vowel,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> F1_50</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Running PCA</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>onze_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  onze_to_pca <span class="sc">%&gt;%</span> <span class="fu">select</span>(DRESS, KIT, TRAP),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale=</span><span class="cn">FALSE</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting PCA information</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Load scores for individuals (contained in onze_pca$x)</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>onze_to_pca <span class="ot">&lt;-</span> onze_to_pca <span class="sc">%&gt;%</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC1 =</span> onze_pca<span class="sc">$</span>x[, <span class="dv">1</span>],</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC2 =</span> onze_pca<span class="sc">$</span>x[, <span class="dv">2</span>]</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract centre. This will be used in the plot.</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>pca_center <span class="ot">&lt;-</span> onze_pca<span class="sc">$</span>center</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>center_tibble <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DRESS"</span> <span class="ot">=</span> pca_center[[<span class="dv">1</span>]],</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"KIT"</span> <span class="ot">=</span> pca_center[[<span class="dv">2</span>]],</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TRAP"</span> <span class="ot">=</span> pca_center[[<span class="dv">3</span>]]</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract loadings.</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>pca_loadings <span class="ot">&lt;-</span> onze_pca<span class="sc">$</span>rotation</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the loadings and centre to find where each point sits along PC1 and PC2</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># when represented in the original 3D space.</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>onze_to_pca <span class="ot">&lt;-</span> onze_to_pca <span class="sc">%&gt;%</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC1_DRESS =</span> (PC1 <span class="sc">*</span> pca_loadings[<span class="dv">1</span>, <span class="dv">1</span>]) <span class="sc">+</span> pca_center[[<span class="dv">1</span>]],</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC1_KIT =</span> (PC1 <span class="sc">*</span> pca_loadings[<span class="dv">2</span>, <span class="dv">1</span>]) <span class="sc">+</span> pca_center[[<span class="dv">2</span>]],</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC1_TRAP =</span> (PC1 <span class="sc">*</span> pca_loadings[<span class="dv">3</span>, <span class="dv">1</span>]) <span class="sc">+</span> pca_center[[<span class="dv">3</span>]],</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC2_DRESS =</span> (PC2 <span class="sc">*</span> pca_loadings[<span class="dv">1</span>, <span class="dv">2</span>]) <span class="sc">+</span> pca_center[[<span class="dv">1</span>]],</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC2_KIT =</span> (PC2 <span class="sc">*</span> pca_loadings[<span class="dv">2</span>, <span class="dv">2</span>]) <span class="sc">+</span> pca_center[[<span class="dv">2</span>]],</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">PC2_TRAP =</span> (PC2 <span class="sc">*</span> pca_loadings[<span class="dv">3</span>, <span class="dv">2</span>]) <span class="sc">+</span> pca_center[[<span class="dv">3</span>]],</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> onze_to_pca,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>DRESS,</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>KIT,</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="sc">~</span>TRAP,</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="co"># What kind of plot.</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"markers"</span>, <span class="co"># What kind of marking (something like geom in ggplot)</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Speakers"</span>, <span class="co"># This label will go in the legend.</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">opacity =</span> <span class="fl">0.8</span>,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray"</span>,</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">lines =</span> <span class="fu">list</span>(</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'black'</span>,</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">1</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">showlegend =</span> <span class="cn">FALSE</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and axis labels</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">t =</span> <span class="dv">90</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"Mean KIT, DRESS, and TRAP F1 for 100 ONZE Speakers"</span>,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">24</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="st">"Open Sans"</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"DRESS F1 (Hz)"</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"KIT F1 (Hz)"</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"TRAP F1 (Hz)"</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> fig <span class="sc">%&gt;%</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add centre mark</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>DRESS,</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>KIT,</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>TRAP,</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> center_tibble,</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">'markers'</span>,</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">6</span>,</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>      <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">'red'</span>,</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>      <span class="at">symbol =</span> <span class="st">"x"</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Center"</span>,</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit =</span> <span class="cn">FALSE</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add PC1 line</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> onze_to_pca,</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>PC1_DRESS,</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>PC1_KIT,</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>PC1_TRAP,</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">'lines'</span>,</span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'PC1'</span>,</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#D55E00"</span>,</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">6</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit =</span> <span class="cn">FALSE</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add PC2 line.</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> onze_to_pca,</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>PC2_DRESS,</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>PC2_KIT,</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="sc">~</span>PC2_TRAP,</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'scatter3d'</span>,</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">'lines'</span>,</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'PC2'</span>,</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"#0072B2"</span>,</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">4</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">inherit =</span> <span class="cn">FALSE</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">scene =</span> <span class="fu">list</span>(</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"DRESS F1 (Hz)"</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"KIT F1 (Hz)"</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>      <span class="at">zaxis =</span> <span class="fu">list</span>(</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"TRAP F1 (Hz)"</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-04b7ce07d724def6a44e" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-04b7ce07d724def6a44e">{"x":{"visdat":{"56913125c762":["function () ","plotlyVisDat"],"569127450c23":["function () ","data"],"5691261fe1f9":["function () ","data"],"5691772cb5fc":["function () ","data"]},"cur_data":"5691772cb5fc","attrs":{"56913125c762":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":2,"opacity":0.80000000000000004,"color":"gray","lines":{"color":"black","width":1},"showlegend":false},"name":"Speakers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"569127450c23":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"markers","marker":{"size":6,"opacity":1,"color":"red","symbol":"x"},"name":"Center","inherit":false},"5691261fe1f9":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines","name":"PC1","line":{"color":"#D55E00","width":6},"inherit":false},"5691772cb5fc":{"x":{},"y":{},"z":{},"type":"scatter3d","mode":"lines","name":"PC2","line":{"color":"#0072B2","width":4},"inherit":false}},"layout":{"margin":{"b":40,"l":60,"t":90,"r":10},"title":{"text":"Mean KIT, DRESS, and TRAP F1 for 100 ONZE Speakers","font":{"size":24,"family":"Open Sans"}},"scene":{"xaxis":{"title":"DRESS F1 (Hz)"},"yaxis":{"title":"KIT F1 (Hz)"},"zaxis":{"title":"TRAP F1 (Hz)"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[622.5797101449275,551.32824427480921,534.70000000000005,455.84259259259261,515.78082191780823,557.5090909090909,605.10344827586209,418.37096774193549,472.48979591836735,507.80000000000001,494.13178294573646,494.13636363636363,584.31645569620252,409.09433962264148,540.79279279279274,586.945652173913,431.28571428571428,581.79279279279274,593.76470588235293,482.75714285714287,493.54545454545456,500.82278481012656,466.89999999999998,469.5609756097561,497.8170731707317,451.1953125,474.27777777777777,562.18032786885249,516.45161290322585,451.74603174603175,380.25510204081633,541.18032786885249,439.87567567567567,386.63888888888891,466.85281385281388,483.66666666666669,455.55737704918033,521.05555555555554,473.74479166666669,433.59459459459458,359.23333333333335,530.81132075471703,511.469696969697,502.78571428571428,495.43617021276594,419.89887640449439,394.21875,364.9221105527638,417.45418326693226,516.90067720090292,532.10298102981028,609.52702702702697,498.3532338308458,476.78908188585609,603.21875,467.71882640586796,566.81200000000001,625.21951219512198,444.05050505050502,605.9655172413793,492.82482993197277,576.35420743639918,458.57602339181284,516.82575757575762,563.7117117117117,417.2823529411765,522.19395465994967,494.37068965517244,451.58755760368666,598.68589743589746,418.04166666666669,529.91327913279133,495.2641509433962,578.66141732283461,549.83127572016463,571.70192307692309,427.94029850746267,483.01249999999999,454.18181818181819,548.10298102981028,480.02459016393442,438.72463768115944,484.08653846153845,456.15909090909093,609.9045226130653,447.02064896755161,515.42168674698792,436.22413793103448,538.97814207650276,415.58620689655174,421.97674418604652,446.17460317460319,517.93193717277484,510.57727272727271,474.57894736842104,559,411.76397515527952,489.34375,447.8987341772152,460.88150289017341],"y":[646.82142857142856,622.24309392265195,588.84444444444443,525.05594405594411,567.83823529411768,634.79487179487182,664.02941176470586,495.58571428571429,450.16216216216219,631.92307692307691,614.05536332179929,566.15079365079362,652,465.53731343283584,619.81308411214957,673.52222222222224,547.71641791044772,602.23148148148152,656.7210884353741,541.60344827586209,541.46268656716416,508.58860759493672,469.64999999999998,485.9159663865546,504.47916666666669,481.49668874172187,589.25423728813564,559.66666666666663,535.14049586776855,464.55339805825241,404.94214876033055,539.36363636363637,487.09609609609612,391.29299363057322,484.39263803680984,504.87234042553189,465.2439024390244,555.49358974358972,479.54437869822488,489.71428571428572,396.73529411764707,532.8496240601504,533.63414634146341,520.9375,473.84438040345822,391.28491620111731,392.6543624161074,457.01168224299067,475.97719869706839,484.6875,484.59701492537312,535.66769230769228,472.04015296367112,490.62972292191438,569.02380952380952,447.387610619469,515.22488038277515,547.83333333333337,508.91389432485323,557.96296296296293,486.43364485981306,549.14773980154359,425.97326203208559,456.40441176470586,528.63617021276593,414.66244725738397,495.33578431372547,460.62459546925567,424.83447098976109,485.34193548387094,357.5,451.02908277404924,443.64583333333331,428.31034482758622,439.171875,418.57692307692309,367.55696202531647,428.38532110091745,393.04285714285714,405.04926108374383,366.22727272727275,398.88679245283021,394.95890410958901,397.30120481927713,452.44334975369458,375.44892473118279,395.25714285714287,405.74025974025972,405.89180327868854,348.2162162162162,354.04861111111109,387.40816326530614,430.47619047619048,417.1556886227545,388.51485148514854,439.57333333333332,338.1720930232558,374.92349726775956,382.22257053291537,378.08764940239041],"z":[637.86666666666667,669.13846153846157,629.56521739130437,579.07272727272732,623.69047619047615,657.5094339622641,662.29999999999995,486.36111111111109,531.9545454545455,668.38297872340422,628.33333333333337,565.7037037037037,691.07692307692309,551.625,624.695652173913,737.93548387096769,583.27999999999997,678.53125,628.78947368421052,570.85185185185185,591.68965517241384,604.14285714285711,561.5625,616.13793103448279,594.31428571428569,485.57999999999998,621.37209302325584,612.41935483870964,576.22727272727275,529.13793103448279,496.68627450980392,620.55555555555554,546.52112676056333,445.3692307692308,588.22340425531911,558.46511627906978,523.62162162162167,633.90909090909088,521.67499999999995,546.39534883720933,473.67073170731709,588.76666666666665,629.70588235294122,647.41176470588232,648.42702702702707,558.29090909090905,506.65873015873018,493.55284552845529,509.74820143884892,613.40559440559446,621.39007092198585,694.87234042553189,588.41358024691363,607.46198830409355,690.28571428571433,593.83941605839414,673.45121951219517,692.53731343283584,638.75091575091574,712.35106382978722,615.35714285714289,727.36986301369859,551.64444444444439,615.15999999999997,613.19375000000002,525.02459016393448,620.15189873417717,596.63846153846157,517.59748427672957,710.97014925373139,455.25,645.6908212560387,613.79999999999995,759.65454545454543,703.38461538461536,751.37142857142862,475.76315789473682,567.67857142857144,526.69230769230774,700.19500000000005,594.41935483870964,531.0140845070423,618.48214285714289,527.9655172413793,690.67256637168146,475.41311475409839,640.32608695652175,492.35294117647061,682.00523560209422,491.78947368421052,546.33076923076919,504.69565217391306,588.87647058823529,587.35433070866145,594.5272727272727,645.45714285714291,510.55345911949684,600.64285714285711,598.59124087591238,618.4341085271318],"mode":"markers","marker":{"color":"gray","size":2,"opacity":0.80000000000000004,"lines":{"color":"black","width":1},"showlegend":false,"line":{"color":"black","width":1}},"name":"Speakers","type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[495.6165178912504],"y":[481.88328640309874],"z":[596.96153969947113],"type":"scatter3d","mode":"markers","marker":{"color":"red","size":6,"opacity":1,"symbol":"x","line":{"color":"rgba(255,127,14,1)"}},"name":"Center","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[596.46069144656894,578.35966398476319,551.18271067723799,494.00050280679221,537.4054802343594,580.76653273787929,604.65672545951475,446.91221640367922,459.77616946253784,569.65839524822047,548.28926874434319,513.99090046392439,603.53974315802668,453.63135614478654,561.66274869746428,625.15752438812547,496.15970326426674,582.66283779932712,589.33837599445712,504.30334659285899,513.27809431592175,507.98554795548046,473.44182966753181,495.59210620478257,502.92637943123475,450.824216576092,532.6825849484228,543.84393662241007,512.78852302432085,458.15173128260949,409.63586787012582,533.85874101074921,467.55141773274164,391.74063312284636,486.15568074925397,488.72076853656893,457.78331990281151,537.72958370570518,466.8406156938608,466.69613400968882,394.50304713522291,519.57034224566189,526.66725755590687,525.32592607670767,508.02587494401757,433.85692413379854,412.24016937710223,421.87239368391073,447.03341852064068,507.09607159036352,513.49561504802364,572.82970089846287,490.57369314663958,496.54763053318663,580.85431403966402,475.76127140852077,548.27943835806855,580.39446800907081,503.01631078811778,584.40696728597356,501.78262412817338,577.94303571170531,453.80040888936685,498.2078282372716,534.18757491755525,431.13386466431751,514.03325097460106,488.13379236481109,441.53972739719592,557.95189061171322,391.86684440656819,508.91201545068958,487.78409122467525,547.95946422741781,527.28297815233293,540.42665649352637,403.89061614553805,465.87603465836804,434.3615599860488,514.56026900038557,452.30956067382755,433.41905342965418,470.0047436787284,436.6796219096446,544.08480864313617,411.53074201335556,484.93931822548353,423.6593726452802,507.04335234326288,398.86559654926333,418.54589743141548,423.87702157195588,482.1781735641826,475.33606441803909,458.27321564767129,512.85470754971425,400.02104828631775,459.52672021198356,450.21411849115293,458.16068334736423],"y":[606.45624127309929,584.0960156140211,550.52428550285799,479.88702060917041,533.50525261591736,587.06922409983883,616.58081405912753,421.71879164567088,437.60965164634251,573.34732563606735,546.95001245744754,504.58118802985194,615.20100419081086,430.0189547807779,563.47029177473632,641.90548091587812,482.55428408767688,589.41173251168971,597.65803459337349,492.61413858480955,503.70065755421189,497.16276730569916,454.49086165548238,481.85313061115318,490.91316903907381,426.55129117190364,527.67105317168284,541.45868719507155,503.09588942270648,435.60298079027854,375.67126386220923,529.12396047318305,447.21442718982826,353.56525424393385,470.19630046458207,473.36495715441538,435.14788167477047,533.90561810740519,446.33637239311321,446.15789395764841,356.97766830776936,511.47348061128611,520.24031045866832,518.58336172347606,497.21258329353429,405.59157003818382,378.88836131720979,390.78706207071991,421.86851279776215,496.06399585284112,503.9693612322539,577.26484413732123,475.65387763132549,483.03349120951901,587.17766047013311,457.35607142553727,546.93786896692575,586.6096119969626,491.02426137557092,591.56625821374496,489.50028644281326,583.58135409985107,430.22778588304982,485.08433585799844,529.53016947850347,402.22777069866214,504.63350367754128,472.639864632198,415.08214812975086,558.88626336191317,353.72116322703971,498.30723395558346,472.20787830306978,546.54260445602904,521.00091101065789,537.2373160611204,368.57414601621633,445.1448240312539,406.21494744346018,505.28452981447242,428.38613890509606,405.05066771786932,450.24502431384713,409.07845272307418,541.75623675405427,378.01200465869567,468.69372606254092,392.9945197914796,495.99887168990432,362.36673197018598,386.67783639185615,393.26338182846587,465.28288002994287,456.83081260920488,435.75305060386029,503.17764726358376,363.79406318844019,437.30150662282654,425.79763611656523,435.61403928894401],"z":[707.30664382686405,687.50024659371013,657.76284445278088,595.19327340822963,642.68760634819591,690.13387602236401,716.27485879363212,543.66861230838208,557.7445295351813,677.97919673109664,654.59679985034597,617.06704591541586,715.05264114812235,551.02078892146392,669.23024852612139,738.70711950556472,597.55590072631901,692.20883952382974,699.51330671591722,606.46678907404225,616.287083465916,610.49590526838142,572.6976859261398,596.93482809095428,604.96009236095858,547.94917757212011,637.51974831796895,649.73265531346317,615.75138771627655,555.96704657515318,502.88031075948203,638.80671471961523,566.25231486123528,483.29909479077276,586.60935947169389,589.41611437887661,555.56392569436946,643.0422448962928,565.47454533594635,565.31645145781351,486.32176681129812,623.17214909265431,630.93769301337159,629.46998936205057,610.54003162285869,529.38332904267816,505.72997386677895,516.26968832564296,543.80123335871212,609.52262779812838,616.52509769110554,681.44928369654565,591.44361038414957,597.98037616573879,690.22992754963013,575.23565149622243,654.58604330429228,689.72675759603294,605.05849650856294,694.11729038450426,603.70857932294132,687.0443661144302,551.20576879730686,599.79698769688321,639.16652937630647,526.40371931301797,617.11338643609952,588.77383684801475,537.78995975025009,665.16977574482019,483.43719694138139,611.50965895017862,588.39118897296828,654.23592313849645,631.61142309544459,645.99341963568452,496.59377602537609,564.4190872856866,529.93550864512611,617.69005692564747,549.5744618433996,528.90420479841396,568.93677839962538,532.47196439973254,649.99622084502869,504.95370853023468,585.27839859800019,518.22502568043433,609.46494166113359,491.09532935221296,512.62978963422665,518.46318017791828,582.25711551916265,574.7703840644391,556.09997646529939,615.82380774897342,492.35964079177779,557.47157867886028,547.28159972069773,555.97684204952407],"type":"scatter3d","mode":"lines","name":"PC1","line":{"color":"#D55E00","width":6},"marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null},{"x":[475.48728758105102,479.63998973381882,478.93884347448471,477.06148772106644,481.07808832087755,475.00616815469277,473.73733559362785,463.27784905142715,489.08638029638871,472.2830698071449,467.90102190017734,468.42974486654333,479.80087788332503,481.88193750847881,470.89681842158677,483.30624234957048,469.42730480223224,489.76352570255489,468.15375484305326,474.32336726454878,479.38735087333271,490.77621130985591,489.02022866592284,495.27885712138573,489.66957247601215,470.28907426721673,470.69451688914677,486.15046339605163,480.64229949381973,482.66051534158157,483.86639979161652,490.4692256051805,478.87906642412037,478.54122608691387,490.21541735832511,481.403258701619,481.88666501743467,486.65626893280199,479.91555069674041,477.50627860965966,479.38356219959138,485.10933399937653,490.34316979673849,495.86015997843697,507.12061661993295,503.02785129499892,490.33812152745338,468.47117591497533,472.43882589132562,500.27846551513699,503.44244687909008,512.61258160864827,496.82255165287506,493.28199823597288,502.65992636601334,500.6813660057025,509.13044409471559,510.83459382220138,490.85101182351639,509.82277804642189,497.55659688176331,511.56881836514265,497.29464087956774,507.72851071337919,494.28896771894688,490.70562222789266,499.4179103836355,500.78283454240051,490.53307522690932,527.08832825214245,492.3341629892077,516.15368237438736,508.33036081695701,548.26074089291569,531.97525679147884,548.42414711086997,494.66820578872773,502.32573094729173,500.51541249523933,539.80471849904984,522.6116124096211,498.14278840596847,520.24945352322254,499.89308181415345,532.8728576197833,494.70622932231345,527.64263730521498,489.00615632034015,535.23481142855019,501.14863748148019,510.44207839527473,496.99962239503344,509.54076096648333,511.81315592878548,516.41189945899293,522.1915851844592,506.72515497973876,522.58871027656437,515.8217954540753,521.95051294857365],"y":[528.1641568914564,518.61631688231364,520.22838345026366,524.54477593748652,515.3098588890623,529.27034056155117,532.18762425919476,556.23594277781353,496.89729576369587,535.53125367187852,545.60640252411179,544.3907693998683,518.2464048938441,513.46165905378621,538.71850523841317,510.18691546594505,542.09719227463654,495.34041165230076,545.0253221540662,530.84022768982743,519.19718093932431,493.01205777514463,497.04939075168124,482.65963175353113,495.55642771663008,540.11582287376291,539.18363435056347,503.64751858568985,516.31181902139372,511.67156279557622,508.8990085947475,493.71787540557136,520.36582208469997,521.14258029408245,494.30142810085937,514.56223128255033,513.45078962528123,502.48457692433999,517.98275061872141,523.52211837968844,519.20589180983666,506.04127006185672,494.00770131818234,481.32310761291018,455.43320882225532,464.84324283863475,494.01930823475954,544.29551165989858,535.17314126277711,471.16459567922755,463.89000994116799,442.80615272262185,479.11038890696074,487.25078432296107,465.68917115906299,470.23825199215122,450.81223903697611,446.8940796431429,492.84007738484468,449.22043361472026,477.422681446355,445.20595990594552,478.02496735716392,454.03554644888743,484.9355728862061,493.1743552952131,473.14317309999115,470.00495682223186,493.57107316681584,409.52370002544285,489.4300350754159,434.6644988491326,452.6517803402063,360.84435798139106,398.28773604025821,360.46865648194989,484.06363353625051,466.45754901819163,470.61981019415271,380.28633719402205,419.81650819187979,476.07491734434831,425.24755388064318,472.05066498633386,396.22398362425298,483.97621031110612,408.24923969584069,497.08174570978667,390.79340944737379,469.16390735402496,447.79654612389396,478.70327010714459,449.8688437005012,444.64418208512819,434.07080941012509,420.78222944946089,456.34244919910509,419.86916448511965,435.42756903805866,421.33649967020062],"z":[563.10929745190151,570.09308555960024,568.91393600165975,565.75670143430614,572.51160136943395,562.30017702751854,560.16632359314201,542.57612929582888,585.97951026443559,557.72061866862589,550.35112937364988,551.24030683664546,570.36365847907678,573.86347111357418,555.38929665597243,576.25878935336755,552.91794875732535,587.11829649585707,550.77616185995623,561.15187971143598,569.66821129592847,588.8213759465209,585.86826005838736,596.39368022333565,586.96029108105211,554.36722566660842,555.04907696661132,581.04204526466435,571.77871547588484,575.17284087131532,577.20083160400009,588.30510412285628,568.81340621693403,568.24524475423163,587.87826324893445,573.05845519002014,573.87142158042934,581.89268144381117,570.5565089656144,566.50472650422341,569.66183971095916,579.29113059956387,588.09311033579468,597.37128368024139,616.30850582792721,609.42551620999257,588.08462043170323,551.30998331540184,557.9825607603982,604.8017490804192,610.12276046281011,625.54459316699263,598.98978153624807,593.03547180296914,608.80676012081267,605.47932516247033,619.68852411494981,622.55447022972737,588.94717137285647,620.85285361429999,600.2242587877904,623.78924904186931,599.78371546308938,617.33082897665599,594.72893818733826,588.70266307643953,603.35451437099186,605.64996941621837,588.41248293609806,649.88911476758801,591.44145415352034,631.49982340170811,618.34298767269502,685.4957241925789,658.10768478794057,685.77053186230626,595.3667201000037,608.24472848332573,605.20023359506013,671.2748466867472,642.36041809915264,601.21008373862378,638.38786805042594,604.1536317802088,659.61722093080959,595.43066600604266,650.82132151645328,585.84459395470049,663.58942609115456,606.26515685844879,621.89435918159177,599.28756945789883,620.37857266262381,624.20016263703178,631.93407881862311,641.6540392084728,615.64343999892276,642.32190254022282,630.94167407100531,641.24861706353249],"type":"scatter3d","mode":"lines","name":"PC2","line":{"color":"#0072B2","width":4},"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The plot above can be rotated with the mouse and the legend on the right allows for different plot elements to be turned off. Double click ‘Speakers’ to see just the points for each speaker.</p>
<p>What are these elements?</p>
<ul>
<li>The points are the mean first formant values for <span class="smallcaps">dress</span>, <span class="smallcaps">trap</span>, and <span class="smallcaps">kit</span> for 100 speakers from the Origins of New Zealand English (ONZE) corpus.</li>
<li>The ‘Center’ is the centre of the cloud of points.</li>
<li>PC1 shows the first principal component derived from the data.</li>
<li>PC2 shows the second principal component.</li>
</ul>
<p>The idea here is to explain PCA in three dimensions as putting a cross in the centre of a cloud of points and then drawing the straight line which captures the most variation in the data. That is, to draw the straight line which is ‘inside’ the cloud of points for as much of its length as possible. We then create the second PC, by finding the line at right angles to the first line which captures the most possible variance.</p>
<p>The data can then be plotted against these two lines rather than the original three dimensions and the same idea extends to cases when we have many many more variables than three.</p>
<p>Ideally, the principal components are <em>interpretable</em>. In this case, the first PC is a line from small values of all three variables to large values. That is, we can interpret it as capturing something like vocal tract length. Speakers with long vocal tracts tend to have lower first formant values.</p>
<p>The second formant is also interpretable. The ONZE corpus contains speakers born in the mid-nineteenth century all the way through to the 1980’s. In this time, <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> have raised, while <span class="smallcaps">kit</span> has lowered. The line for PC2 (the blue line), runs from high values of <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> and low values of <span class="smallcaps">kit</span> to low values of <span class="smallcaps">dress</span> and <span class="smallcaps">trap</span> and high values of <span class="smallcaps">kit</span>. That is, it captures the structure in our data which comes from the structured change in vowel spaces which has occurred over time in New Zealand English.</p>
</section>
<section id="lessons-learned" class="level2">
<h2 class="anchored" data-anchor-id="lessons-learned">Lessons Learned</h2>
<p>I have not found the <code>plotly</code> documentation for R to be very easy to get my head into.</p>
<p>A few things which caused me trouble and might help you:</p>
<ul>
<li><code>plotly</code> is not ‘surly’. Surliness is a feature of the <code>tidyverse</code> packages: they complain. If you add an argument to a <code>plotly</code> function which it doesn’t recognise, it will often just ignore it without telling you. This is not great for people who like to use ‘colour’ rather than ‘color’ or ‘grey’ rather than ‘gray’.</li>
<li>Often an initial plot is made with <code>plot_ly()</code> and then additional features are added to the plot with <code>add_trace()</code>. In this case, the points are added to the plot at the <code>plot_ly()</code> stage, and the lines and the red cross added using <code>add_trace()</code>. The first argument to <code>plot_ly()</code> is a data frame, but this is not the case for <code>add_trace()</code>. I have found being explicit by saying <code>data = onze_to_pca</code> rather than just having <code>plot_ly(onze_to_pca ...)</code>, avoids confusion. It took me a long time to work out why my <code>add_trace(onze_to_pca)</code> was not functioning.</li>
<li>If the added element is different in <code>type</code> from the original plot, it is vital to add <code>inherit = FALSE</code> to any <code>add_trace()</code> calls. My initial attempts to add lines to the plot added both lines <em>and</em> points (‘markers’ in <code>plotly</code> speak) because I failed to add <code>inherit = FALSE</code>.</li>
<li>Axis labelling for 3D plots occurs by modifying the <code>scene</code> rather than <code>xaxis</code> or <code>yaxis</code> etc. directly. See the call to <code>layout()</code> in the plot code.</li>
</ul>
<p>It may be that there are obvious solutions to some of these problems. If so, please let me know!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/joshua\.wilsonblack\.nz");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p><a href="https://paperspast.natlib.govt.nz/newspapers/AS19031024.2.47.11.6.1"><img src="../../images/logo.png" class="img-fluid"></a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/JoshuaWilsonBlack/quarto-personal/edit/main/posts/plotly-struggles/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/JoshuaWilsonBlack/quarto-personal/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>